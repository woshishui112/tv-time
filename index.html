<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…çº§ç”µè§†æ—¶é—´èµšå–å™¨ Ultimate (é™æ—¶ç‰ˆ)</title>
    <style>
        :root { 
            --primary: #2c3e50; 
            --wolf: #8e44ad; 
            --fact: #2980b9; 
            --logic: #d35400; 
            --bg: #f0f2f5; 
            --card: #ffffff; 
            --green: #27ae60;
            --red: #c0392b;
            --orange: #f39c12;
            --timer-bg: #e0e0e0;
        }
        body { font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; background: var(--bg); color: #2c3e50; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; user-select: none; }
        
        /* é¡¶éƒ¨çœ‹æ¿ */
        header { 
            width: 100%; max-width: 650px; margin-bottom: 20px; 
            background: linear-gradient(135deg, var(--primary), #34495e);
            color: white; padding: 20px; border-radius: 16px;
            box-shadow: 0 8px 20px rgba(0,0,0,0.15);
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .title-area h1 { margin: 0; font-size: 1.5rem; letter-spacing: 1px; }
        .title-area p { margin: 5px 0 0; opacity: 0.9; font-size: 0.9rem; color: #ecf0f1; }
        .score-box { text-align: right; background: rgba(255,255,255,0.1); padding: 10px 15px; border-radius: 10px; }
        .score-num { font-size: 2rem; font-weight: bold; color: var(--orange); line-height: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.2); }
        .score-label { font-size: 0.75rem; opacity: 0.9; }

        /* å¯¼èˆª */
        nav { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; width: 100%; max-width: 650px; }
        .nav-btn { 
            flex: 1; padding: 12px; border: none; background: white; border-radius: 12px; 
            cursor: pointer; font-weight: bold; color: #bdc3c7; font-size: 0.95rem;
            transition: all 0.2s; box-shadow: 0 2px 5px rgba(0,0,0,0.05); position: relative; overflow: hidden;
        }
        .nav-btn.active { color: white; transform: translateY(-2px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .nav-btn[data-tab="fact"].active { background: var(--fact); }
        .nav-btn[data-tab="wolf"].active { background: var(--wolf); }
        .nav-btn[data-tab="logic"].active { background: var(--logic); }
        .nav-btn.finished::after { content: 'âœ”'; position: absolute; right: 5px; top: 5px; font-size: 0.8rem; }
        .nav-btn.finished { opacity: 0.7; background: #95a5a6 !important; color: #fff; text-decoration: line-through; }

        /* ä¸»å¡ç‰‡ */
        main { width: 100%; max-width: 650px; position: relative; perspective: 1000px; }
        .card { background: var(--card); padding: 30px; border-radius: 20px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); display: none; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card.active { display: block; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* è®¡æ—¶å™¨æ¡ */
        .timer-container {
            width: 100%; height: 8px; background: var(--timer-bg); border-radius: 4px; 
            margin-bottom: 20px; overflow: hidden; position: relative;
        }
        .timer-bar {
            height: 100%; width: 100%; background: var(--green);
            transform-origin: left; transition: width 1s linear, background 0.3s;
        }
        .timer-text {
            position: absolute; right: 0; top: -25px; font-size: 0.9rem; font-weight: bold; color: var(--primary);
        }

        /* è¿›åº¦ä¸é¢˜ç›® */
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 0.9rem; color: #7f8c8d; font-weight: bold; }
        .q-text { font-size: 1.35rem; font-weight: 700; line-height: 1.5; margin: 15px 0 30px; color: #2c3e50; min-height: 70px; }
        
        /* é€‰é¡¹æŒ‰é’® */
        .options-grid { display: grid; gap: 15px; }
        .btn-opt { 
            padding: 18px; border: 2px solid #ecf0f1; background: white; border-radius: 15px; 
            cursor: pointer; font-size: 1.1rem; text-align: left; transition: 0.2s; font-weight: 600; color: #576574; position: relative;
        }
        .btn-opt:hover { border-color: var(--primary); background: #f8f9fa; transform: translateX(5px); }
        .btn-opt:active { transform: scale(0.99); }
        
        .fact-btns { display: flex; gap: 20px; }
        .fact-btns button { flex: 1; padding: 25px; font-size: 1.2rem; border: none; border-radius: 15px; cursor: pointer; color: white; font-weight: bold; box-shadow: 0 4px 0 rgba(0,0,0,0.2); transition: transform 0.1s; }
        .fact-btns button:active { transform: translateY(4px); box-shadow: none; }
        .btn-f { background: var(--fact); }
        .btn-o { background: #e67e22; }

        /* åé¦ˆ */
        .feedback-box { margin-top: 25px; padding: 20px; border-radius: 15px; display: none; text-align: center; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .feedback-box.correct { background: #e8f8f5; border: 2px solid #a2d9ce; color: #16a085; }
        .feedback-box.wrong { background: #fdedec; border: 2px solid #fadbd8; color: #c0392b; }
        .feedback-box.timeout { background: #ebf5fb; border: 2px solid #aed6f1; color: #2e86c1; } /* è¶…æ—¶æ ·å¼ */
        
        .explain-text { font-size: 1rem; margin-top: 10px; text-align: left; background: rgba(255,255,255,0.6); padding: 10px; border-radius: 10px; }

        .next-btn { 
            margin-top: 20px; width: 100%; padding: 18px; 
            background: var(--primary); color: white; 
            border: none; border-radius: 15px; 
            cursor: pointer; font-size: 1.2rem; font-weight: bold; letter-spacing: 1px;
            display: none; box-shadow: 0 4px 0 #1a252f;
        }
        .next-btn:active { transform: translateY(4px); box-shadow: none; }

        /* ç»“ç®—å¡ç‰‡ */
        .coupon { background: #fff; border: 4px dashed var(--orange); text-align: center; padding: 40px 20px; }
        .coupon-val { font-size: 5rem; font-weight: 800; color: var(--orange); margin: 10px 0; text-shadow: 2px 2px 0px rgba(0,0,0,0.1); }
        .bonus-tag { background: var(--red); color: white; padding: 8px 20px; border-radius: 30px; font-size: 1rem; display: inline-block; margin-bottom: 15px; font-weight: bold; box-shadow: 0 4px 10px rgba(192, 57, 43, 0.4); }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 480px) {
            .q-text { font-size: 1.1rem; }
            .btn-opt { padding: 15px; font-size: 1rem; }
            .fact-btns button { font-size: 1rem; padding: 20px; }
        }
    </style>
</head>
<body>

<header>
    <div class="title-area">
        <h1>ğŸ§  è„‘åŠ›é£æš´ Ultimate</h1>
        <p>éšæœº50é¢˜ (åº“å®¹é‡500+) | é™æ—¶20ç§’</p>
    </div>
    <div class="score-box">
        <div class="score-label">å½“å‰å¾—åˆ†</div>
        <div><span class="score-num" id="global-score">0</span> <span style="font-size:1rem">åˆ†</span></div>
    </div>
</header>

<nav>
    <button class="nav-btn active" id="nav-fact" data-tab="fact" onclick="switchTab('fact')">1. äº‹å®é‰´åˆ« (15é¢˜)</button>
    <button class="nav-btn" id="nav-wolf" data-tab="wolf" onclick="switchTab('wolf')">2. é€»è¾‘ç‹¼äºº (20é¢˜)</button>
    <button class="nav-btn" id="nav-logic" data-tab="logic" onclick="switchTab('logic')">3. æ·±åº¦æ¨ç† (15é¢˜)</button>
</nav>

<main>
    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game-card" class="card active">
        <div class="header-row">
            <span id="progress-text">é¢˜ç›® 1 / 15</span>
            <div style="position: relative; width: 60px; text-align: right;">
                <span id="timer-num">20</span>s
            </div>
        </div>
        
        <!-- å€’è®¡æ—¶æ¡ -->
        <div class="timer-container">
            <div class="timer-bar" id="timer-bar"></div>
        </div>

        <div id="question-area">
            <div class="q-text" id="q-text">é¢˜ç›®åŠ è½½ä¸­...</div>
            
            <!-- Fact Buttons -->
            <div class="fact-btns" id="fact-btns" style="display:none;">
                <button class="btn-f" onclick="checkAnswer('fact')">ğŸ“˜ äº‹å® (Fact)</button>
                <button class="btn-o" onclick="checkAnswer('opinion')">ğŸ“™ è§‚ç‚¹ (Opinion)</button>
            </div>

            <!-- Generic Options Buttons -->
            <div class="options-grid" id="opt-btns" style="display:none;"></div>
        </div>

        <div id="feedback" class="feedback-box"></div>
        <button class="next-btn" id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â¡ï¸</button>
    </div>

    <!-- å…³å¡å®Œæˆç•Œé¢ -->
    <div id="done-card" class="card" style="text-align:center; padding:50px 20px;">
        <h2 style="color:var(--green); font-size:2rem; margin-bottom:10px;">ğŸ‰ æœ¬å…³æŒ‘æˆ˜ç»“æŸï¼</h2>
        <div style="font-size:4rem; margin:20px 0;">âœ…</div>
        <p style="font-size:1.2rem; color:#7f8c8d;">è¯·ç‚¹å‡»ä¸Šæ–¹å¯¼èˆªæ ï¼Œ<br>åˆ‡æ¢åˆ°ä¸‹ä¸€ä¸ªæŒ‘æˆ˜åŒºåŸŸã€‚</p>
    </div>

    <!-- æœ€ç»ˆå…‘æ¢åˆ¸ -->
    <div id="coupon-card" class="card coupon">
        <div id="bonus-msg" class="bonus-tag" style="display:none;">ğŸ‰ è§¦å‘è¶…çº§å¥–åŠ±ï¼</div>
        <h2 style="color:#2c3e50; margin:0;">âœ¨ ç”µè§†æ—¶é—´å…‘æ¢åˆ¸ âœ¨</h2>
        <div class="coupon-val"><span id="final-minutes">0</span> åˆ†é’Ÿ</div>
        <div class="coupon-note">
            åŸå§‹å¾—åˆ†: <span id="raw-score">0</span>/50<br>
            <span id="reward-explain" style="font-size:0.95rem; line-height:1.6; display:block; margin-top:10px;"></span>
        </div>
        <button onclick="location.reload()" style="margin-top:30px; padding:10px 20px; background:#bdc3c7; border:none; border-radius:8px; cursor:pointer; color:white; font-weight:bold;">æ˜æ—¥å†æˆ˜ (åˆ·æ–°)</button>
    </div>
</main>

<script>
    // ==========================================
    // â¬‡ï¸ é™æ€æµ·é‡é¢˜åº“ (éƒ¨åˆ†å±•ç¤ºï¼Œé€»è¾‘ç”Ÿæˆå™¨åœ¨å)
    // ==========================================

    const staticFactDB = [
        // ç§‘å­¦/å¸¸è¯†
        { t: "fact", q: "æ°´åœ¨æ ‡å‡†å¤§æ°”å‹ä¸‹100æ‘„æ°åº¦æ²¸è…¾ã€‚", e: "ç§‘å­¦å®šå¾‹ã€‚" },
        { t: "fact", q: "å…‰é€Ÿæ¯”å£°é€Ÿå¿«ã€‚", e: "æ‰“é›·å…ˆçœ‹é—ªç”µåå¬é›·å£°ã€‚" },
        { t: "fact", q: "åœ°çƒåªæœ‰ä¸€ä¸ªå¤©ç„¶å«æ˜Ÿï¼ˆæœˆçƒï¼‰ã€‚", e: "å¤©æ–‡äº‹å®ã€‚" },
        { t: "fact", q: "èœ˜è››æœ‰8æ¡è…¿ï¼Œæ˜†è™«æœ‰6æ¡è…¿ã€‚", e: "ç”Ÿç‰©åˆ†ç±»å­¦äº‹å®ã€‚" },
        { t: "fact", q: "æ¤ç‰©é€šè¿‡å…‰åˆä½œç”¨äº§ç”Ÿæ°§æ°”ã€‚", e: "ç”Ÿç‰©å­¦äº‹å®ã€‚" },
        { t: "fact", q: "ç ç©†æœ—ç›å³°æ˜¯ä¸–ç•Œä¸Šæµ·æ‹”æœ€é«˜çš„å±±å³°ã€‚", e: "åœ°ç†äº‹å®ã€‚" },
        { t: "fact", q: "äººä½“æœ€å¤§çš„å™¨å®˜æ˜¯çš®è‚¤ã€‚", e: "è§£å‰–å­¦äº‹å®ã€‚" },
        { t: "fact", q: "ä¼é¹…ä¸»è¦ç”Ÿæ´»åœ¨å—åŠçƒã€‚", e: "åœ°ç†åˆ†å¸ƒäº‹å®ã€‚" },
        { t: "fact", q: "æ°´æ˜¯ç”±æ°¢å’Œæ°§ç»„æˆçš„ã€‚", e: "åŒ–å­¦åˆ†å­å¼H2Oã€‚" },
        { t: "fact", q: "ä¸­å›½çš„é¦–éƒ½æ˜¯åŒ—äº¬ã€‚", e: "å¸¸è¯†ã€‚" },
        { t: "fact", q: "ä¸‰è§’å½¢å†…è§’å’Œä¸º180åº¦ã€‚", e: "å‡ ä½•å®šç†ã€‚" },
        { t: "fact", q: "ä¸€å¹´æœ‰å››ä¸ªå­£èŠ‚ï¼ˆå¤§éƒ¨åˆ†æ¸©å¸¦åœ°åŒºï¼‰ã€‚", e: "æ°”å€™äº‹å®ã€‚" },
        { t: "fact", q: "æœˆäº®åå°„å¤ªé˜³çš„å…‰ã€‚", e: "æœˆäº®æœ¬èº«ä¸å‘å…‰ã€‚" },
        { t: "fact", q: "èœ‚èœœæ˜¯å¯ä»¥æ°¸ä¹…ä¿å­˜çš„é£Ÿç‰©ã€‚", e: "è€ƒå¤å‘ç°åƒå¹´å‰èœ‚èœœä»å¯é£Ÿç”¨ã€‚" },
        { t: "fact", q: "çŒè±¹æ˜¯é™†åœ°ä¸Šè·‘å¾—æœ€å¿«çš„åŠ¨ç‰©ã€‚", e: "ç”Ÿç‰©äº‹å®ã€‚" },
        { t: "fact", q: "äºšé©¬é€Šæ²³æ˜¯ä¸–ç•Œä¸Šæµé‡æœ€å¤§çš„æ²³æµã€‚", e: "åœ°ç†æ•°æ®ã€‚" },
        { t: "fact", q: "é’»çŸ³æ˜¯è‡ªç„¶ç•Œæœ€åšç¡¬çš„ç‰©è´¨ä¹‹ä¸€ã€‚", e: "ç‰©ç†æ€§è´¨ã€‚" },
        { t: "fact", q: "äººç±»çš„å¿ƒè„ä½äºèƒ¸è…”å·¦ä¾§ã€‚", e: "è§£å‰–å­¦ä½ç½®ã€‚" },
        { t: "fact", q: "é±¼é€šå¸¸ç”¨é³ƒå‘¼å¸ã€‚", e: "ç”Ÿç‰©ç‰¹å¾ã€‚" },
        { t: "fact", q: "å†°çš„å¯†åº¦æ¯”æ¶²æ€æ°´å°ã€‚", e: "æ‰€ä»¥å†°æµ®åœ¨æ°´é¢ä¸Šã€‚" },
        // è§‚ç‚¹/ä¸»è§‚
        { t: "opinion", q: "ã€Šå“ˆåˆ©æ³¢ç‰¹ã€‹æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çœ‹çš„å°è¯´ã€‚", e: "è¿™æ˜¯ä¸ªäººå–œå¥½ã€‚" },
        { t: "opinion", q: "è“è‰²æ¯”çº¢è‰²å¥½çœ‹ã€‚", e: "å®¡ç¾æ˜¯ä¸»è§‚çš„ã€‚" },
        { t: "opinion", q: "å¤å¤©æ¯”å†¬å¤©æ›´èˆ’æœã€‚", e: "æ€•çƒ­çš„äººä¼šåå¯¹ã€‚" },
        { t: "opinion", q: "æ•°å­¦æ¯”è¯­æ–‡æ›´éš¾ã€‚", e: "å¯¹æŸäº›äººæ¥è¯´è¯­æ–‡æ›´éš¾ã€‚" },
        { t: "opinion", q: "ç‹—æ˜¯æ¯”çŒ«æ›´å¥½çš„å® ç‰©ã€‚", e: "çŒ«æ´¾äººå£«ä¸åŒæ„ã€‚" },
        { t: "opinion", q: "è‰è“å†°æ·‡æ·‹æœ€ç¾å‘³ã€‚", e: "å£å‘³å› äººè€Œå¼‚ã€‚" },
        { t: "opinion", q: "å°å­¦ç”Ÿä¸åº”è¯¥æœ‰å®¶åº­ä½œä¸šã€‚", e: "è¿™æ˜¯ä¸€ç§æ•™è‚²è§‚ç‚¹ã€‚" },
        { t: "opinion", q: "è¿™å°±æ˜¯æœ€å®Œç¾çš„ä¸€å¤©ã€‚", e: "æ„Ÿè§‰æ˜¯ä¸»è§‚çš„ã€‚" },
        { t: "opinion", q: "é‚£ä¸ªç”µå½±å¤ªæ— èŠäº†ã€‚", e: "åˆ«äººå¯èƒ½è§‰å¾—æœ‰è¶£ã€‚" },
        { t: "opinion", q: "æ‹¥æœ‰å¾ˆå¤šé’±æ˜¯å¹¸ç¦çš„å”¯ä¸€æ ‡å‡†ã€‚", e: "ä»·å€¼è§‚ä¸åŒã€‚" },
        { t: "opinion", q: "ç”µå­æ¸¸æˆçº¯ç²¹æ˜¯æµªè´¹æ—¶é—´ã€‚", e: "ä¹Ÿå¯ä»¥æ˜¯èŒä¸šæˆ–æ”¾æ¾ã€‚" },
        { t: "opinion", q: "æ¯ä¸ªäººéƒ½åº”è¯¥å­¦ä¼šå¼¹é’¢ç´ã€‚", e: "ä¹å™¨é€‰æ‹©æ˜¯è‡ªç”±çš„ã€‚" },
        { t: "opinion", q: "è¶³çƒæ˜¯ä¸–ç•Œä¸Šæœ€æ¿€åŠ¨äººå¿ƒçš„è¿åŠ¨ã€‚", e: "ç¯®çƒè¿·å¯èƒ½åå¯¹ã€‚" },
        { t: "opinion", q: "é›¨å¤©è®©äººæ„Ÿåˆ°å¿§éƒã€‚", e: "æœ‰äººå–œæ¬¢é›¨å£°ã€‚" },
        { t: "opinion", q: "è¿™æ¡è£™å­å¤ªè´µäº†ã€‚", e: "å¯¹åœŸè±ªæ¥è¯´å¯èƒ½ä¾¿å®œã€‚" },
        { t: "opinion", q: "æ—©èµ·æ¯”ç†¬å¤œå¥½ã€‚", e: "è™½ç„¶å¥åº·ï¼Œä½†ä¹Ÿæ˜¯ä¸€ç§ç”Ÿæ´»æ–¹å¼è¯„ä»·ã€‚" },
        { t: "opinion", q: "æ‰€æœ‰äººéƒ½åº”è¯¥å–œæ¬¢åƒè¾£ã€‚", e: "å£å‘³åå¥½ã€‚" },
        { t: "opinion", q: "æœ€å¥½çš„åº¦å‡æ–¹å¼æ˜¯å»æµ·è¾¹ã€‚", e: "æœ‰äººå–œæ¬¢çˆ¬å±±ã€‚" },
        { t: "opinion", q: "åªè¦åŠªåŠ›å°±ä¸€å®šèƒ½æˆåŠŸã€‚", e: "è¿™æ˜¯ä¸€ç§ä¿¡å¿µï¼Œä¸ä¸€å®šæ˜¯å®¢è§‚è§„å¾‹ã€‚" },
        { t: "opinion", q: "è¿™é“èœå¤ªå’¸äº†ã€‚", e: "å£å‘³é‡çš„äººè§‰å¾—åˆšå¥½ã€‚" }
    ];

    const staticWolfDB = [
        { q: "Aè¯´ï¼š'å¤ªé˜³ç»•ç€åœ°çƒè½¬'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "åœ°å¿ƒè¯´æ˜¯é”™çš„ï¼Œåœ°çƒç»•å¤ªé˜³è½¬ã€‚" },
        { q: "Aè¯´ï¼š'ä¼é¹…æ˜¯å“ºä¹³åŠ¨ç‰©'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "ä¼é¹…æ˜¯é¸Ÿç±»ã€‚" },
        { q: "Aè¯´ï¼š'æ‰€æœ‰çš„å¶æ•°éƒ½èƒ½è¢«2æ•´é™¤'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "è¿™æ˜¯å¶æ•°çš„å®šä¹‰ï¼ŒçœŸè¯ã€‚" },
        { q: "Aè¯´ï¼š'æˆ‘æ­£åœ¨è¯´è°'ã€‚Aæ˜¯ï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº", "æ‚–è®º/é€»è¾‘é”™è¯¯"], c: 2, e: "ç»å…¸çš„'è¯´è°è€…æ‚–è®º'ï¼Œæ— è®ºèº«ä»½å¦‚ä½•éƒ½çŸ›ç›¾ã€‚" },
        { q: "Aè¯´ï¼š'å†°æ¯”æ°´é‡ï¼Œæ‰€ä»¥ä¼šæ²‰ä¸‹å»'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "å†°æ¯”æ°´è½»ï¼Œä¼šæµ®èµ·æ¥ã€‚" },
        { q: "Aè¯´ï¼š'è™è ä¼šé£ï¼Œä½†å®ƒæ˜¯å“ºä¹³åŠ¨ç‰©'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "çœŸè¯ï¼Œè™è æ˜¯å”¯ä¸€ä¼šé£çš„å“ºä¹³åŠ¨ç‰©ã€‚" },
        { q: "Aè¯´ï¼š'1æ–¤é“æ¯”1æ–¤æ£‰èŠ±é‡'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "éƒ½æ˜¯1æ–¤ï¼Œä¸€æ ·é‡ã€‚" },
        { q: "Aè¯´ï¼š'å¦‚æœä½ æŠŠæ­£æ–¹å½¢åˆ‡æˆä¸¤åŠï¼Œå¯èƒ½å¾—åˆ°ä¸¤ä¸ªä¸‰è§’å½¢'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "æ²¿å¯¹è§’çº¿åˆ‡å°±æ˜¯ä¸‰è§’å½¢ã€‚" },
        { q: "Aè¯´ï¼š'å£°éŸ³åœ¨çœŸç©ºä¸­ä¼ æ’­æœ€å¿«'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "çœŸç©ºä¸­æ²¡æœ‰ä»‹è´¨ï¼Œå£°éŸ³æ— æ³•ä¼ æ’­ã€‚" },
        { q: "Aè¯´ï¼š'æ˜¨å¤©æ˜¯å‘¨äº”ï¼Œæ˜å¤©å°±æ˜¯å‘¨æ—¥'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "æ˜¨å¤©å‘¨äº”->ä»Šå¤©å‘¨å…­->æ˜å¤©å‘¨æ—¥ã€‚é€»è¾‘æ­£ç¡®ã€‚" },
        { q: "Aè¯´ï¼š'é»„ç“œå…¶å®æ˜¯é•¿åœ¨æ ‘ä¸Šçš„'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "é»„ç“œæ˜¯è—¤è”“æ¤ç‰©ã€‚" },
        { q: "Aè¯´ï¼š'æœ‰äº›é¸Ÿä¸ä¼šé£'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "çœŸè¯ï¼Œå¦‚é¸µé¸Ÿã€ä¼é¹…ã€‚" },
        { q: "Aè¯´ï¼š'é²¸é±¼ç”¨é³ƒå‘¼å¸'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "é²¸é±¼æ˜¯å“ºä¹³åŠ¨ç‰©ï¼Œç”¨è‚ºå‘¼å¸ã€‚" },
        { q: "Aè¯´ï¼š'ä»»ä½•æ•°ä¹˜ä»¥0éƒ½å¾—0'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "æ•°å­¦çœŸç†ã€‚" },
        { q: "Aè¯´ï¼š'å¸çƒŸæœ‰ç›Šå¥åº·'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "å…¬è®¤çš„è°è¨€ã€‚" },
        { q: "Aè¯´ï¼š'ä¸­å›½çš„å›½æ——ä¸Šæœ‰5é¢—æ˜Ÿ'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "äº”æ˜Ÿçº¢æ——ã€‚" },
        { q: "Aè¯´ï¼š'èœ—ç‰›è·‘å¾—æ¯”å…”å­å¿«'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "å¯“è¨€å’Œäº‹å®éƒ½è¯æ˜è¿™æ˜¯å‡çš„ã€‚" },
        { q: "Aè¯´ï¼š'æœˆäº®æœ¬èº«ä¸å‘å…‰'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "çœŸè¯ï¼Œåå°„å¤ªé˜³å…‰ã€‚" },
        { q: "Aè¯´ï¼š'ä¸‰è§’å½¢æœ‰4æ¡è¾¹'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "é‚£æ˜¯å››è¾¹å½¢ã€‚" },
        { q: "Aè¯´ï¼š'æ¤ç‰©å…‰åˆä½œç”¨éœ€è¦é˜³å…‰'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "çœŸè¯ã€‚" },
        { q: "Aè¯´ï¼š'å¦‚æœæˆ‘æ˜¯å¥½äººï¼Œæˆ‘å°±ä¼šè¯´å‡è¯'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "å¥½äººä¸ä¼šè¯´å‡è¯ï¼Œåªæœ‰ç‹¼äººä¼šèƒ¡è¨€ä¹±è¯­æ··æ·†é€»è¾‘ã€‚" }
    ];

    // ==========================================
    // â¬‡ï¸ åŠ¨æ€é¢˜ç›®ç”Ÿæˆå¼•æ“ (æ— é™é¢˜åº“æ ¸å¿ƒ)
    // ==========================================
    
    // ç”Ÿæˆæ•°å­—åºåˆ—é¢˜
    function genSequence() {
        const type = Math.floor(Math.random() * 4); // 0:åŠ æ³•, 1:ä¹˜æ³•, 2:å‡æ³•, 3:æ–æ³¢é‚£å¥‘å˜ä½“
        let qText = "", correct = "", opts = [], explain = "";
        
        if (type === 0) { // ç­‰å·®æ•°åˆ—
            const start = Math.floor(Math.random() * 10) + 1;
            const diff = Math.floor(Math.random() * 8) + 2;
            const nums = [start, start+diff, start+diff*2, start+diff*3];
            qText = `æ‰¾è§„å¾‹ï¼š${nums.join(', ')}, ?`;
            correct = (start+diff*4).toString();
            opts = [correct, (start+diff*4 - 1).toString(), (start+diff*4 + 2).toString()];
            explain = `è§„å¾‹æ˜¯æ¯æ¬¡åŠ  ${diff}ã€‚`;
        } else if (type === 1) { // ç­‰æ¯”æ•°åˆ—
            const start = Math.floor(Math.random() * 3) + 1;
            const ratio = 2; // ä¿æŒç®€å•
            const nums = [start, start*ratio, start*ratio*ratio, start*ratio*ratio*ratio];
            qText = `æ‰¾è§„å¾‹ï¼š${nums.join(', ')}, ?`;
            correct = (nums[3]*ratio).toString();
            opts = [correct, (nums[3]*ratio + 2).toString(), (nums[3]*ratio - 1).toString()];
            explain = `è§„å¾‹æ˜¯æ¯æ¬¡ä¹˜ä»¥ ${ratio}ã€‚`;
        } else { // ç®€å•æ–æ³¢é‚£å¥‘
            const n1 = Math.floor(Math.random() * 3) + 1;
            const n2 = Math.floor(Math.random() * 3) + 1;
            const nums = [n1, n2, n1+n2, n1+n2+n2];
            qText = `æ‰¾è§„å¾‹ï¼š${nums.join(', ')}, ?`;
            correct = (nums[2]+nums[3]).toString();
            opts = [correct, (correct-1).toString(), (correct+2).toString()];
            explain = `å‰ä¸¤ä¸ªæ•°ç›¸åŠ ç­‰äºåä¸€ä¸ªæ•°ï¼š${nums[2]} + ${nums[3]} = ${correct}`;
        }
        return { text: qText, options: shuffleArray(opts), correct: opts.indexOf(correct), explain: explain };
    }

    // ç”Ÿæˆæ—¥æœŸé€»è¾‘é¢˜
    function genDateLogic() {
        const days = ["å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­", "å‘¨æ—¥"];
        const idx = Math.floor(Math.random() * 7);
        const diff = Math.floor(Math.random() * 3) + 1; // 1-3å¤©
        const targetDay = days[(idx + diff) % 7];
        
        let qText = `å¦‚æœä»Šå¤©æ˜¯${days[idx]}ï¼Œé‚£ä¹ˆ${diff}å¤©åæ˜¯ï¼Ÿ`;
        let correct = targetDay;
        let wrong1 = days[(idx + diff + 1) % 7];
        let wrong2 = days[(idx + diff - 1 + 7) % 7];
        
        return { 
            text: qText, 
            options: shuffleArray([correct, wrong1, wrong2]), 
            correct: -1, // éœ€é‡æ–°è®¡ç®—
            actualCorrect: correct,
            explain: `${days[idx]} å¾€åæ¨ ${diff} å¤©æ˜¯ ${correct}ã€‚` 
        };
    }

    // ç”Ÿæˆæ¯”è¾ƒé¢˜
    function genComparison() {
        const names = ["A", "B", "C", "D"];
        // A > B, B > C => A > C
        const p1 = Math.floor(Math.random() * 20) + 20; // A height
        const p2 = p1 - (Math.floor(Math.random() * 5) + 1); // B height
        const p3 = p2 - (Math.floor(Math.random() * 5) + 1); // C height
        
        const qText = `å·²çŸ¥ï¼šç”²æ¯”ä¹™é«˜ï¼Œä¸™æ¯”ä¹™çŸ®ã€‚<br>è°æœ€é«˜ï¼Ÿ`;
        // é€»è¾‘å›ºå®šï¼šç”² > ä¹™ > ä¸™
        const options = ["ç”²", "ä¹™", "ä¸™"];
        const correctIdx = 0;
        
        return {
            text: qText,
            options: options,
            correct: correctIdx,
            explain: "ç”²æ¯”ä¹™é«˜ï¼Œä¹™åˆæ¯”ä¸™é«˜ï¼Œæ‰€ä»¥ç”²æœ€é«˜ã€‚"
        };
    }

    // ç”Ÿæˆæ•°å­¦åº”ç”¨é¢˜
    function genMathWord() {
        const n1 = Math.floor(Math.random() * 5) + 3;
        const n2 = Math.floor(Math.random() * 5) + 2;
        const total = n1 * n2;
        
        const qText = `ä¸€è¾†è½¦æœ‰${n1}ä¸ªåº§ä½ï¼Œ${n2}è¾†è½¦ä¸€å…±æœ‰å¤šå°‘ä¸ªåº§ä½ï¼Ÿ`;
        const correct = total.toString();
        const opts = [correct, (total-1).toString(), (total+n1).toString()];
        
        return {
            text: qText,
            options: shuffleArray(opts),
            correct: -1, 
            actualCorrect: correct,
            explain: `${n1} x ${n2} = ${total}ã€‚`
        };
    }

    // æ‰¹é‡ç”Ÿæˆé€»è¾‘é¢˜ä»¥å¡«å……é¢˜åº“
    function generateLogicPool(count) {
        const pool = [];
        for(let i=0; i<count; i++) {
            const rand = Math.random();
            let q;
            if (rand < 0.4) q = genSequence();
            else if (rand < 0.6) q = genDateLogic();
            else if (rand < 0.8) q = genMathWord();
            else q = genComparison();
            
            // ä¿®å¤optionsç´¢å¼•
            if(q.correct === -1) {
                q.correct = q.options.indexOf(q.actualCorrect);
            }
            pool.push(q);
        }
        return pool;
    }

    // ==========================================
    // â¬‡ï¸ æ¸¸æˆæ§åˆ¶æ ¸å¿ƒ
    // ==========================================

    let gameState = {
        fact: { idx: 0, list: [], finished: false },
        wolf: { idx: 0, list: [], finished: false },
        logic: { idx: 0, list: [], finished: false }
    };
    let globalScore = 0;
    let currentTab = 'fact';
    let timerInterval;
    const TIME_LIMIT = 20; 

    function shuffleArray(array) {
        let arr = JSON.parse(JSON.stringify(array));
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function initGame() {
        // 1. äº‹å®é¢˜ï¼šéšæœºå–15é“ (å¦‚æœé™æ€åº“å¤Ÿå¤§ï¼Œè¿™é‡Œå¯ä»¥ä¸é‡å¤)
        // ä¸ºäº†æ¨¡æ‹Ÿ500é“é¢˜åº“ï¼Œæˆ‘ä»¬è¿™é‡Œç®€å•å°†é™æ€åº“å¤åˆ¶å‡ å€å†æ´—ç‰Œï¼Œæˆ–è€…å‡è®¾é™æ€åº“å·²ç»å¾ˆå¤§
        // å®é™…æ“ä½œï¼šä» staticFactDB éšæœºæŠ½
        let fullFact = shuffleArray(staticFactDB);
        // å¦‚æœé¢˜ç›®ä¸å¤Ÿï¼Œå¯ä»¥é€šè¿‡åè½¬é€»è¾‘(æŠŠFactæ”¹Opinion)æ¥ç”Ÿæˆæ–°é¢˜ï¼Œè¿™é‡Œç®€å•å¤„ç†ï¼š
        // å®é™…åœºæ™¯ä¸‹ï¼ŒstaticFactDBåº”è¯¥æœ‰150+æ¡ï¼Œè¿™é‡Œæ¼”ç¤ºç”¨äº†40æ¡å·¦å³ã€‚
        // æˆ‘ä»¬å¾ªç¯åˆ©ç”¨ä¸€ä¸‹ä»¥é˜²ä¸‡ä¸€
        while(fullFact.length < 15) fullFact = fullFact.concat(shuffleArray(staticFactDB));
        gameState.fact.list = fullFact.slice(0, 15);

        // 2. ç‹¼äººé¢˜ï¼šéšæœºå–20é“
        let fullWolf = shuffleArray(staticWolfDB);
        while(fullWolf.length < 20) fullWolf = fullWolf.concat(shuffleArray(staticWolfDB));
        gameState.wolf.list = fullWolf.slice(0, 20);

        // 3. é€»è¾‘é¢˜ï¼šåŠ¨æ€ç”Ÿæˆ15é“ (ç»å¯¹ä¸é‡å¤)
        gameState.logic.list = generateLogicPool(15);
        
        console.log("ä»Šæ—¥é¢˜ç›®å·²éšæœºç”Ÿæˆå®Œæ¯•ã€‚");
        
        globalScore = 0;
        document.getElementById('global-score').innerText = "0";
        renderQuestion();
    }

    function switchTab(tab) {
        currentTab = tab;
        clearInterval(timerInterval); // åˆ‡æ¢Tabæ—¶æš‚åœä¸Šä¸€é¢˜å€’è®¡æ—¶ï¼ˆè§†ä½œæœªå®Œæˆéœ€é‡ç½®ï¼Ÿæˆ–è€…ç›´æ¥åŠ è½½è¯¥tabè¿›åº¦ï¼‰
        
        // UI æ›´æ–°
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.nav-btn[data-tab="${tab}"]`).classList.add('active');
        
        document.getElementById('game-card').style.display = 'none';
        document.getElementById('done-card').style.display = 'none';
        document.getElementById('coupon-card').style.display = 'none';

        if (gameState.fact.finished && gameState.wolf.finished && gameState.logic.finished) {
            calculateFinalReward();
            return;
        }

        if (gameState[tab].finished) {
            document.getElementById('done-card').style.display = 'block';
        } else {
            document.getElementById('game-card').style.display = 'block';
            renderQuestion(); // é‡æ–°æ¸²æŸ“ä¼šé‡å¯è®¡æ—¶å™¨
        }
    }

    function startTimer() {
        clearInterval(timerInterval);
        let timeLeft = TIME_LIMIT;
        const timerBar = document.getElementById('timer-bar');
        const timerNum = document.getElementById('timer-num');
        
        // é‡ç½®æ ·å¼
        timerBar.style.transition = 'none';
        timerBar.style.width = '100%';
        timerBar.style.backgroundColor = 'var(--green)';
        timerNum.innerText = timeLeft;
        timerNum.style.color = 'var(--primary)';

        // å¼ºåˆ¶é‡ç»˜
        timerBar.offsetHeight; 

        // å¼€å§‹åŠ¨ç”»
        timerBar.style.transition = `width ${TIME_LIMIT}s linear`;
        timerBar.style.width = '0%';

        timerInterval = setInterval(() => {
            timeLeft--;
            timerNum.innerText = timeLeft;
            
            // å˜è‰²æé†’
            if(timeLeft <= 5) {
                timerBar.style.backgroundColor = 'var(--red)';
                timerNum.style.color = 'var(--red)';
            } else if (timeLeft <= 10) {
                timerBar.style.backgroundColor = 'var(--orange)';
            }

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                handleTimeout();
            }
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
        const timerBar = document.getElementById('timer-bar');
        const computedStyle = window.getComputedStyle(timerBar);
        const w = computedStyle.getPropertyValue('width');
        timerBar.style.transition = 'none';
        timerBar.style.width = w; // å†»ç»“è¿›åº¦æ¡
    }

    function handleTimeout() {
        const state = gameState[currentTab];
        const q = state.list[state.idx];
        
        // ç¦ç”¨æŒ‰é’®
        disableAllButtons();
        
        // æ˜¾ç¤ºè¶…æ—¶åé¦ˆ
        const fb = document.getElementById('feedback');
        fb.style.display = 'block';
        fb.className = 'feedback-box timeout';
        fb.innerHTML = `<strong>â° æ—¶é—´åˆ°ï¼</strong><br>å¤ªå¯æƒœäº†ï¼Œæ²¡èƒ½åœ¨è§„å®šæ—¶é—´å†…ä½œç­”ã€‚<div class="explain-text">æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${getCorrectAnswerText(q, currentTab)}<br>${q.e || q.explain}</div>`;
        
        document.getElementById('next-btn').style.display = 'block';
    }

    function getCorrectAnswerText(q, tab) {
        if(tab === 'fact') return q.t === 'fact' ? "äº‹å®" : "è§‚ç‚¹";
        if(tab === 'wolf') return q.o[q.c];
        if(tab === 'logic') return q.options[q.correct];
    }

    function renderQuestion() {
        const state = gameState[currentTab];
        const q = state.list[state.idx];
        const total = state.list.length;

        document.getElementById('progress-text').innerText = `é¢˜ç›® ${state.idx + 1} / ${total}`;
        document.getElementById('q-text').innerHTML = q.q || q.text; // å…¼å®¹ä¸åŒå­—æ®µå
        
        document.getElementById('feedback').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        
        const factGroup = document.getElementById('fact-btns');
        const optGroup = document.getElementById('opt-btns');

        if (currentTab === 'fact') {
            factGroup.style.display = 'flex';
            optGroup.style.display = 'none';
            Array.from(factGroup.children).forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.transform = 'scale(1)';
            });
        } else {
            factGroup.style.display = 'none';
            optGroup.style.display = 'grid';
            optGroup.innerHTML = '';
            
            const opts = q.o || q.options;
            opts.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'btn-opt';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i, btn);
                optGroup.appendChild(btn);
            });
        }

        startTimer(); // é¢˜ç›®åŠ è½½å®Œç«‹å³å€’è®¡æ—¶
    }

    function disableAllButtons() {
        if (currentTab === 'fact') {
            Array.from(document.getElementById('fact-btns').children).forEach(b => {
                b.disabled = true;
                b.style.opacity = '0.6';
            });
        } else {
            Array.from(document.getElementById('opt-btns').children).forEach(b => {
                b.disabled = true;
                b.style.cursor = 'default';
            });
        }
    }

    function checkAnswer(userIndex, btnRef) {
        stopTimer(); // åœæ­¢å€’è®¡æ—¶
        
        const state = gameState[currentTab];
        const q = state.list[state.idx];
        let isCorrect = false;

        if (currentTab === 'fact') {
            const userType = (userIndex === 'fact') ? 'fact' : 'opinion';
            isCorrect = (userType === q.t);
            disableAllButtons();
        } else {
            const correctIdx = (q.c !== undefined) ? q.c : q.correct;
            isCorrect = (userIndex === correctIdx);
            disableAllButtons();
            
            const opts = document.getElementById('opt-btns').children;
            if (isCorrect) {
                btnRef.style.background = '#e8f8f5';
                btnRef.style.borderColor = '#2ecc71';
            } else {
                btnRef.style.background = '#fdedec';
                btnRef.style.borderColor = '#e74c3c';
                if(opts[correctIdx]) {
                    opts[correctIdx].style.background = '#e8f8f5';
                    opts[correctIdx].style.borderColor = '#2ecc71';
                }
            }
        }

        if (isCorrect) {
            globalScore += 1;
            document.getElementById('global-score').innerText = globalScore;
        }

        const fb = document.getElementById('feedback');
        fb.style.display = 'block';
        fb.className = isCorrect ? 'feedback-box correct' : 'feedback-box wrong';
        fb.innerHTML = `<strong>${isCorrect ? 'ğŸ‰ ç­”å¯¹äº†ï¼' : 'ğŸ˜… ç­”é”™äº†'}</strong><div class="explain-text">${q.e || q.explain}</div>`;
        
        document.getElementById('next-btn').style.display = 'block';
    }

    function nextQuestion() {
        const state = gameState[currentTab];
        state.idx++;
        
        if (state.idx >= state.list.length) {
            state.finished = true;
            document.querySelector(`.nav-btn[data-tab="${currentTab}"]`).classList.add('finished');
            
            if (gameState.fact.finished && gameState.wolf.finished && gameState.logic.finished) {
                calculateFinalReward();
            } else {
                document.getElementById('game-card').style.display = 'none';
                document.getElementById('done-card').style.display = 'block';
            }
        } else {
            renderQuestion();
        }
    }

    function calculateFinalReward() {
        document.getElementById('game-card').style.display = 'none';
        document.getElementById('done-card').style.display = 'none';
        document.getElementById('coupon-card').style.display = 'block';

        let finalTime = 0;
        let msg = "";
        let showBonus = false;

        // éš¾åº¦UPï¼šå› ä¸ºæœ‰å€’è®¡æ—¶ï¼Œè¯„åˆ†æ ‡å‡†ç¨å¾®æ”¾å®½ä¸€ç‚¹ç‚¹ï¼Œæˆ–è€…ä¿æŒé«˜æ ‡å‡†
        if (globalScore >= 48) {
            finalTime = 75; // æ»¡åˆ†å¥–åŠ±
            msg = "ğŸ† ç¥çº§è¡¨ç°ï¼é”™è¯¯â‰¤2ï¼Œè·å¾—é¡¶çº§å¥–åŠ± 75 åˆ†é’Ÿï¼";
            showBonus = true;
        } else if (globalScore >= 42) {
            finalTime = globalScore + 15;
            msg = "ğŸ˜ é’»çŸ³å¤§è„‘ï¼å¾—åˆ†>42ï¼Œé¢å¤–å¥–åŠ± 15 åˆ†é’Ÿï¼";
            showBonus = true;
        } else if (globalScore >= 35) {
            finalTime = globalScore;
            msg = "ğŸ™‚ è¡¨ç°ä¸é”™ã€‚æ¯1åˆ†å…‘æ¢1åˆ†é’Ÿç”µè§†æ—¶é—´ã€‚";
        } else {
            finalTime = Math.floor(globalScore * 0.8);
            msg = "ğŸ˜… æ—¶é—´ç´§è¿«å¯¼è‡´å¤±è¯¯è¾ƒå¤šï¼Œæ—¶é—´æ‰“8æŠ˜ï¼Œæ˜å¤©ç»§ç»­ç»ƒï¼";
        }

        document.getElementById('raw-score').innerText = globalScore;
        document.getElementById('final-minutes').innerText = finalTime;
        document.getElementById('reward-explain').innerText = msg;
        
        if (showBonus) {
            document.getElementById('bonus-msg').style.display = 'inline-block';
        }
    }

    // å¯åŠ¨æ¸¸æˆ
    initGame();

</script>
</body>
</html>
