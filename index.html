<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è¶…çº§ç”µè§†æ—¶é—´èµšå–å™¨</title>
    <style>
        :root { 
            --primary: #2c3e50; 
            --wolf: #8e44ad; 
            --fact: #2980b9; 
            --logic: #e67e22; /* æ–°å¢é€»è¾‘å…³å¡çš„é¢œè‰² */
            --bg: #f0f3f5; 
            --card: #ffffff; 
            --green: #2ecc71;
            --red: #e74c3c;
            --orange: #f39c12;
        }
        body { font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif; background: var(--bg); color: #2c3e50; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; }
        
        /* é¡¶éƒ¨çœ‹æ¿ */
        header { 
            text-align: center; 
            width: 100%; 
            max-width: 600px;
            margin-bottom: 20px; 
            background: var(--primary);
            color: white;
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .title-area h1 { margin: 0; font-size: 1.4rem; }
        .title-area p { margin: 5px 0 0; opacity: 0.8; font-size: 0.9rem; }
        
        .score-box { text-align: right; }
        .score-num { font-size: 2.2rem; font-weight: bold; color: var(--orange); line-height: 1; }
        .score-label { font-size: 0.8rem; opacity: 0.8; }

        /* å¯¼èˆª */
        nav { display: flex; gap: 10px; margin-bottom: 20px; flex-wrap: wrap; justify-content: center; }
        .nav-btn { 
            padding: 10px 15px; 
            border: none; 
            background: white; 
            border-radius: 20px; 
            cursor: pointer; 
            font-weight: bold; 
            color: #bdc3c7; 
            font-size: 0.9rem;
            transition: 0.2s;
            box-shadow: 0 3px 0 rgba(0,0,0,0.05);
        }
        .nav-btn.active { color: white; transform: translateY(2px); box-shadow: none; }
        
        .nav-btn[data-tab="fact"].active { background: var(--fact); }
        .nav-btn[data-tab="wolf"].active { background: var(--wolf); }
        .nav-btn[data-tab="logic"].active { background: var(--logic); } /* æ–°æ ·å¼ */
        
        /* å®Œæˆæ ‡è®° */
        .nav-btn.finished { opacity: 0.6; position: relative; }
        .nav-btn.finished::after { content: 'âœ”'; position: absolute; top: -5px; right: -5px; background: var(--green); color: white; border-radius: 50%; width: 18px; height: 18px; font-size: 10px; line-height: 18px; text-align: center; }

        /* ä¸»å¡ç‰‡ */
        main { width: 100%; max-width: 600px; position: relative; }
        .card { background: var(--card); padding: 25px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.05); display: none; animation: slideUp 0.3s; }
        .card.active { display: block; }

        @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        /* è¿›åº¦æ¡ */
        .progress-bar-bg { background: #ecf0f1; height: 10px; border-radius: 5px; margin-bottom: 20px; overflow: hidden; }
        .progress-bar-fill { height: 100%; background: var(--green); width: 0%; transition: width 0.3s; }
        .progress-text { text-align: right; font-size: 0.8rem; color: #7f8c8d; margin-bottom: 5px; font-weight: bold; }

        /* é¢˜ç›® */
        .q-text { font-size: 1.3rem; font-weight: 700; line-height: 1.5; margin-bottom: 25px; min-height: 60px; color: #34495e; }
        
        /* æŒ‰é’®é€šç”¨ */
        .options-grid { display: grid; gap: 12px; }
        .btn-opt { 
            padding: 15px; 
            border: 2px solid #ecf0f1; 
            background: white; 
            border-radius: 12px; 
            cursor: pointer; 
            font-size: 1.1rem; 
            text-align: left; 
            transition: 0.2s; 
            font-weight: 600;
            color: #7f8c8d;
        }
        .btn-opt:hover { border-color: var(--primary); background: #f8f9fa; }
        
        /* äº‹å®è§‚ç‚¹å¤§æŒ‰é’® */
        .fact-btns { display: flex; gap: 15px; }
        .fact-btns button { flex: 1; padding: 20px; font-size: 1.2rem; border: none; border-radius: 15px; cursor: pointer; color: white; font-weight: bold; transition: transform 0.1s; }
        .fact-btns button:active { transform: scale(0.98); }
        .btn-f { background: var(--fact); box-shadow: 0 4px 0 #1f6391; }
        .btn-o { background: #e67e22; box-shadow: 0 4px 0 #ca6f1e; }

        /* åé¦ˆåŒº */
        .feedback-box { margin-top: 25px; padding: 15px; border-radius: 12px; display: none; text-align: center; }
        .feedback-box.correct { background: #e8f8f5; border: 2px solid #a2d9ce; color: #16a085; }
        .feedback-box.wrong { background: #fdedec; border: 2px solid #fadbd8; color: #c0392b; }
        .explain-text { font-size: 0.95rem; margin-top: 8px; text-align: left; background: rgba(255,255,255,0.7); padding: 8px; border-radius: 8px; }

        .next-btn { 
            margin-top: 20px; width: 100%; padding: 15px; 
            background: var(--primary); color: white; 
            border: none; border-radius: 12px; 
            cursor: pointer; font-size: 1.1rem; font-weight: bold;
            display: none; box-shadow: 0 4px 0 #1a252f;
        }
        .next-btn:active { transform: translateY(4px); box-shadow: none; }

        /* å…‘æ¢åˆ¸ */
        .coupon {
            background: #fff;
            border: 4px dashed var(--orange);
            text-align: center;
            padding: 30px;
        }
        .coupon-val { font-size: 4rem; font-weight: bold; color: var(--orange); margin: 10px 0; }
        .coupon-note { font-size: 1.1rem; color: #7f8c8d; margin-top: 10px; }
        .bonus-tag { 
            background: var(--red); color: white; padding: 5px 15px; 
            border-radius: 20px; font-size: 0.9rem; display: inline-block; 
            margin-bottom: 10px; font-weight: bold;
        }

    </style>
</head>
<body>

<header>
    <div class="title-area">
        <h1>ğŸ“º ç”µè§†æ—¶é—´èµšå–å™¨</h1>
        <p>ç­”å¯¹è¶Šå¤šï¼Œå¥–åŠ±è¶Šä¸°åšï¼</p>
    </div>
    <div class="score-box">
        <div class="score-label">å½“å‰å¾—åˆ†</div>
        <div><span class="score-num" id="global-score">0</span> <span style="font-size:1rem">åˆ†</span></div>
    </div>
</header>

<nav>
    <button class="nav-btn active" id="nav-fact" data-tab="fact" onclick="switchTab('fact')">1. ç®€å•çƒ­èº« (10é¢˜)</button>
    <button class="nav-btn" id="nav-wolf" data-tab="wolf" onclick="switchTab('wolf')">2. ç‹¼äººæ€ (20é¢˜)</button>
    <button class="nav-btn" id="nav-logic" data-tab="logic" onclick="switchTab('logic')">3. ä½ç½®æ¨ç† (10é¢˜)</button>
</nav>

<main>
    <!-- æ¸¸æˆä¸»ç•Œé¢ -->
    <div id="game-card" class="card active">
        <div class="progress-text" id="progress-text">å‡†å¤‡å¼€å§‹...</div>
        <div class="progress-bar-bg">
            <div class="progress-bar-fill" id="progress-bar"></div>
        </div>

        <div id="question-area">
            <div class="q-text" id="q-text">é¢˜ç›®åŠ è½½ä¸­...</div>
            
            <!-- Fact Buttons -->
            <div class="fact-btns" id="fact-btns" style="display:none;">
                <button class="btn-f" onclick="checkAnswer('fact')">ğŸ“˜ äº‹å® (Fact)</button>
                <button class="btn-o" onclick="checkAnswer('opinion')">ğŸ“™ è§‚ç‚¹ (Opinion)</button>
            </div>

            <!-- Generic Options Buttons -->
            <div class="options-grid" id="opt-btns" style="display:none;"></div>
        </div>

        <div id="feedback" class="feedback-box"></div>
        <button class="next-btn" id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â¡ï¸</button>
    </div>

    <!-- å…³å¡å®Œæˆç•Œé¢ -->
    <div id="done-card" class="card" style="text-align:center; padding:50px 20px;">
        <h2 style="color:var(--green); font-size:2rem;">ğŸ‰ æœ¬å…³å®Œæˆï¼</h2>
        <p style="font-size:1.2rem; color:#7f8c8d;">è¯·ç‚¹å‡»ä¸Šæ–¹æŒ‰é’®ï¼Œåˆ‡æ¢ä¸‹ä¸€ä¸ªæŒ‘æˆ˜ã€‚</p>
    </div>

    <!-- æœ€ç»ˆå…‘æ¢åˆ¸ -->
    <div id="coupon-card" class="card coupon">
        <div id="bonus-msg" class="bonus-tag" style="display:none;">ğŸ‰ è§¦å‘è¶…çº§å¥–åŠ±ï¼</div>
        <h2 style="color:#2c3e50; margin:0;">âœ¨ ç”µè§†æ—¶é—´å…‘æ¢åˆ¸ âœ¨</h2>
        <div class="coupon-val"><span id="final-minutes">0</span> åˆ†é’Ÿ</div>
        <div class="coupon-note">
            åŸå§‹å¾—åˆ†: <span id="raw-score">0</span>/40<br>
            <span id="reward-explain" style="font-size:0.9rem"></span>
        </div>
        <p style="margin-top:30px; font-size:0.9rem; color:#bdc3c7;">æŒ‘æˆ˜å·²ç»“æŸ</p>
    </div>
</main>

<script>
    // ==========================================
    // â¬‡ï¸ é¢˜åº“åŒº (å…¨éƒ¨æ›´æ–°)
    // ==========================================

    // 1. äº‹å® vs è§‚ç‚¹ (10é¢˜)
    const factDB = [
        { text: "å¤ªé˜³ä»ä¸œè¾¹å‡èµ·ã€‚", type: "fact", explain: "è¿™æ˜¯è‡ªç„¶è§„å¾‹ã€‚" },
        { text: "è“è‰²æ˜¯ä¸–ç•Œä¸Šæœ€å¥½çœ‹çš„é¢œè‰²ã€‚", type: "opinion", explain: "è¿™æ˜¯ä¸ªäººå–œå¥½ï¼Œæœ‰äººå–œæ¬¢çº¢è‰²ã€‚" },
        { text: "å…”å­é•¿ç€é•¿è€³æœµã€‚", type: "fact", explain: "è¿™æ˜¯å…”å­çš„ç‰¹å¾ã€‚" },
        { text: "æ•°å­¦ä½œä¸šå¤ªéš¾äº†ã€‚", type: "opinion", explain: "å¯¹ä½ æ¥è¯´å¯èƒ½éš¾ï¼Œå¯¹åˆ«äººå¯èƒ½ç®€å•ã€‚" },
        { text: "æ°´ç…®å¼€äº†ä¼šå¾ˆçƒ«ã€‚", type: "fact", explain: "è¿™æ˜¯ç‰©ç†å¸¸è¯†ï¼Œåƒä¸‡åˆ«æ‘¸ï¼" },
        { text: "å†¬å¤©åƒå†°æ·‡æ·‹å¾ˆèˆ’æœã€‚", type: "opinion", explain: "æœ‰äººè§‰å¾—å†·ï¼Œæœ‰äººè§‰å¾—çˆ½ã€‚" },
        { text: "ä¸€å¹´æœ‰å››ä¸ªå­£èŠ‚ã€‚", type: "fact", explain: "æ˜¥ã€å¤ã€ç§‹ã€å†¬ã€‚" },
        { text: "è¿™ä¸ªæ¸¸æˆéå¸¸æœ‰è¶£ã€‚", type: "opinion", explain: "è¿™æ˜¯ä½ çš„æ„Ÿè§‰ã€‚" },
        { text: "é±¼å¿…é¡»ç”Ÿæ´»åœ¨æ°´é‡Œã€‚", type: "fact", explain: "ç¦»å¼€æ°´é±¼æ´»ä¸äº†ã€‚" },
        { text: "æ±‰å ¡åŒ…æ¯”ç±³é¥­å¥½åƒã€‚", type: "opinion", explain: "è¿™æ˜¯å£å‘³é—®é¢˜ã€‚" }
    ];

    // 2. ç‹¼äººæ€ (20é¢˜) - ç®€å•è§„åˆ™ï¼šå¥½äººè¯´çœŸè¯ï¼Œç‹¼äººè¯´å‡è¯
    const wolfDB = [
        { text: "Aè¯´ï¼š'é›ªæ˜¯é»‘è‰²çš„'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "é›ªæ˜¯ç™½çš„ï¼ŒAåœ¨æ’’è°ã€‚" },
        { text: "Aè¯´ï¼š'ç³–æ˜¯ç”œçš„'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 0, explain: "Aè¯´äº†çœŸè¯ã€‚" },
        { text: "Aè¯´ï¼š'å¤§è±¡æ¯”èš‚èšå°'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "èƒ¡è¯´å…«é“ï¼Œå¤§è±¡å¾ˆå¤§ã€‚" },
        { text: "Aè¯´ï¼š'é¸Ÿä¼šåœ¨å¤©ä¸Šé£'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 0, explain: "äº‹å®å¦‚æ­¤ã€‚" },
        { text: "Aè¯´ï¼š'çŸ³å¤´å¯ä»¥å½“é¥­åƒ'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "åƒçŸ³å¤´ä¼šç”Ÿç—…çš„ï¼ŒAæ˜¯ç‹¼äººã€‚" },
        { text: "Aè¯´ï¼š'ç«æ˜¯éå¸¸çƒ«çš„'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 0, explain: "çœŸè¯ã€‚" },
        { text: "Aè¯´ï¼š'æˆ‘å¯ä»¥ä¸€å£æ°”å–å¹²å¤§æµ·'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "ä»–åœ¨å¹ç‰›ï¼Œæ˜¯ç‹¼äººã€‚" },
        { text: "Aè¯´ï¼š'ä»Šå¤©æ˜¯æ˜ŸæœŸå…«'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "æ²¡æœ‰æ˜ŸæœŸå…«ã€‚" },
        { text: "Aè¯´ï¼š'åœ°çƒæ˜¯åœ†çš„'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 0, explain: "çœŸè¯ã€‚" },
        { text: "Aè¯´ï¼š'1+1=3'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "ç®—é”™å•¦ï¼Œæ˜¯ç‹¼äººã€‚" },
        
        { text: "Aè¯´ï¼š'æˆ‘ä¸åƒä¸œè¥¿èƒ½æ´»ä¸€ä¸‡å¹´'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "å¤ªå¤¸å¼ äº†ï¼Œè‚¯å®šæ˜¯å‡è¯ã€‚" },
        { text: "Aè¯´ï¼š'å°ç‹—ä¼šæ±ªæ±ªå«'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 0, explain: "çœŸè¯ã€‚" },
        { text: "Aè¯´ï¼š'æ±½è½¦æ˜¯ç”¨æ­£æ–¹å½¢è½®å­è·‘çš„'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "æ­£æ–¹å½¢è½®å­è·‘ä¸åŠ¨ã€‚" },
        { text: "Aè¯´ï¼š'å¤å¤©å¾ˆçƒ­'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 0, explain: "çœŸè¯ã€‚" },
        { text: "Aè¯´ï¼š'æˆ‘æ˜¯é€æ˜äººï¼Œä½ çœ‹ä¸è§æˆ‘'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "ä½ çœ‹å¾—è§ä»–ï¼Œä»–åœ¨éª—äººã€‚" },
        { text: "Aè¯´ï¼š'å†°å—æ˜¯çƒ­çš„'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "å†°å—æ˜¯å†·çš„ã€‚" },
        { text: "Aè¯´ï¼š'è¥¿ç“œé•¿åœ¨æ ‘ä¸Š'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "è¥¿ç“œé•¿åœ¨åœ°ä¸Šã€‚" },
        { text: "Aè¯´ï¼š'æ™šä¸Šä¼šæœ‰æœˆäº®'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 0, explain: "çœŸè¯ã€‚" },
        { text: "Aè¯´ï¼š'é±¼åœ¨å¤©ä¸Šé£'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 1, explain: "é±¼åœ¨æ°´é‡Œæ¸¸ã€‚" },
        { text: "Aè¯´ï¼š'æˆ‘ä»¬è¦è®²å«ç”Ÿ'ã€‚<br>Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", options: ["å¥½äºº", "ç‹¼äºº"], correct: 0, explain: "è¿™æ˜¯æ­£ç¡®çš„é“ç†ã€‚" }
    ];

    // 3. ä½ç½®æ¨ç† (10é¢˜) - ç®€å•ç©ºé—´é€»è¾‘
    const logicDB = [
        { text: "ğŸåœ¨ğŸŒçš„å·¦è¾¹ã€‚<br>è¯·é—®è°åœ¨å³è¾¹ï¼Ÿ", options: ["ğŸ è‹¹æœ", "ğŸŒ é¦™è•‰"], correct: 1, explain: "è‹¹æœåœ¨å·¦ï¼Œé‚£é¦™è•‰å°±åœ¨å³ã€‚" },
        { text: "A åœ¨ B çš„å‰é¢ã€‚<br>B åœ¨ C çš„å‰é¢ã€‚<br>è°æ’åœ¨æœ€åé¢ï¼Ÿ", options: ["A", "B", "C"], correct: 2, explain: "é¡ºåºæ˜¯ A -> B -> Cï¼Œæ‰€ä»¥Cåœ¨æœ€åã€‚" },
        { text: "å°æ˜ä½åœ¨ 3æ¥¼ã€‚<br>å°çº¢ä½åœ¨å°æ˜çš„ä¸Šé¢ä¸€å±‚ã€‚<br>å°çº¢ä½å‡ æ¥¼ï¼Ÿ", options: ["2æ¥¼", "4æ¥¼"], correct: 1, explain: "3æ¥¼çš„ä¸Šé¢æ˜¯4æ¥¼ã€‚" },
        { text: "ğŸ”´çº¢çƒ åœ¨ ğŸ”µè“çƒ çš„å·¦è¾¹ã€‚<br>ğŸ”µè“çƒ åœ¨ ğŸŸ¢ç»¿çƒ çš„å·¦è¾¹ã€‚<br>è°åœ¨æœ€ä¸­é—´ï¼Ÿ", options: ["ğŸ”´çº¢çƒ", "ğŸ”µè“çƒ", "ğŸŸ¢ç»¿çƒ"], correct: 1, explain: "é¡ºåºæ˜¯ï¼šçº¢ - è“ - ç»¿ã€‚" },
        { text: "å·¦æ‰‹æ‹¿ç€âœï¸é“…ç¬”ï¼Œå³æ‰‹æ‹¿ç€ğŸ“å°ºå­ã€‚<br>è¯·é—®å°ºå­åœ¨å“ªè¾¹ï¼Ÿ", options: ["å·¦è¾¹", "å³è¾¹"], correct: 1, explain: "é¢˜ç›®è¯´äº†å³æ‰‹æ‹¿ç€å°ºå­ã€‚" },
        { text: "A åœ¨ B çš„å·¦è¾¹ã€‚<br>C åœ¨ A çš„å·¦è¾¹ã€‚<br>è°åœ¨æœ€å·¦è¾¹ï¼Ÿ", options: ["A", "B", "C"], correct: 2, explain: "é¡ºåºæ˜¯ï¼šC - A - Bã€‚" },
        { text: "å¤§æ ‘çš„å·¦è¾¹æ˜¯æˆ¿å­ï¼Œå³è¾¹æ˜¯å°æ²³ã€‚<br>æˆ¿å­åœ¨å°æ²³çš„å“ªè¾¹ï¼Ÿ", options: ["å·¦è¾¹", "å³è¾¹"], correct: 0, explain: "æˆ¿å­(å·¦) - æ ‘ - å°æ²³(å³)ï¼Œæ‰€ä»¥æˆ¿å­åœ¨æœ€å·¦è¾¹ã€‚" },
        { text: "å°ç‹—åœ¨å°çŒ«åé¢ï¼Œå°é¸­åœ¨å°ç‹—åé¢ã€‚<br>è°è·‘ç¬¬ä¸€ï¼Ÿ", options: ["å°çŒ«", "å°ç‹—", "å°é¸­"], correct: 0, explain: "å°çŒ« -> å°ç‹— -> å°é¸­ã€‚" },
        { text: "ä¹¦æ¶åˆ†ä¸‰å±‚ã€‚<br>ä¸Šå±‚æ˜¯æ¼«ç”»ï¼Œä¸‹å±‚æ˜¯æ•…äº‹ä¹¦ã€‚<br>å­—å…¸åœ¨ä¸­é—´ã€‚<br>æ•…äº‹ä¹¦åœ¨å“ªä¸€å±‚ï¼Ÿ", options: ["ä¸Šå±‚", "ä¸­å±‚", "ä¸‹å±‚"], correct: 2, explain: "é¢˜ç›®è¯´äº†ä¸‹å±‚æ˜¯æ•…äº‹ä¹¦ã€‚" },
        { text: "1å·åœ¨2å·å·¦è¾¹ï¼Œ2å·åœ¨3å·å·¦è¾¹ã€‚<br>è¯·é—®3å·åœ¨å“ªé¢ï¼Ÿ", options: ["æœ€å·¦é¢", "æœ€å³é¢", "ä¸­é—´"], correct: 1, explain: "1 - 2 - 3ï¼Œæ‰€ä»¥3åœ¨æœ€å³é¢ã€‚" }
    ];

    // ==========================================
    // â¬‡ï¸ æ¸¸æˆé€»è¾‘
    // ==========================================

    let gameState = {
        fact: { idx: 0, list: factDB, finished: false },
        wolf: { idx: 0, list: wolfDB, finished: false },
        logic: { idx: 0, list: logicDB, finished: false } // æ–°å¢ logic
    };
    let globalScore = 0;
    let currentTab = 'fact';

    function switchTab(tab) {
        currentTab = tab;
        
        // æ›´æ–°å¯¼èˆªæŒ‰é’®
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.nav-btn[data-tab="${tab}"]`).classList.add('active');
        
        // éšè—ä¸éœ€è¦çš„ç•Œé¢
        document.getElementById('game-card').style.display = 'none';
        document.getElementById('done-card').style.display = 'none';
        document.getElementById('coupon-card').style.display = 'none';

        // åˆ¤æ–­æ˜¯å¦å…¨éƒ¨é€šå…³ (ä¸‰ä¸ªéƒ½å®Œæˆ)
        if (gameState.fact.finished && gameState.wolf.finished && gameState.logic.finished) {
            calculateFinalReward();
            return;
        }

        // åˆ¤æ–­å½“å‰å…³å¡æ˜¯å¦å®Œæˆ
        if (gameState[tab].finished) {
            document.getElementById('done-card').style.display = 'block';
        } else {
            document.getElementById('game-card').style.display = 'block';
            renderQuestion();
        }
    }

    function renderQuestion() {
        const state = gameState[currentTab];
        const q = state.list[state.idx];
        const total = state.list.length;

        // è¿›åº¦æ›´æ–°
        document.getElementById('progress-text').innerText = `è¿›åº¦ï¼š${state.idx + 1} / ${total}`;
        document.getElementById('progress-bar').style.width = `${((state.idx)/total)*100}%`;

        // é¢˜ç›®æ˜¾ç¤º
        document.getElementById('q-text').innerHTML = q.text;
        
        // é‡ç½®çŠ¶æ€
        document.getElementById('feedback').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        
        // æŒ‰é’®æ˜¾ç¤ºé€»è¾‘
        const factGroup = document.getElementById('fact-btns');
        const optGroup = document.getElementById('opt-btns');

        if (currentTab === 'fact') {
            factGroup.style.display = 'flex';
            optGroup.style.display = 'none';
            // è§£é”æŒ‰é’®
            Array.from(factGroup.children).forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.transform = 'scale(1)';
            });
        } else {
            factGroup.style.display = 'none';
            optGroup.style.display = 'grid';
            optGroup.innerHTML = ''; // æ¸…ç©º
            
            q.options.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'btn-opt';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i, btn);
                optGroup.appendChild(btn);
            });
        }
    }

    function checkAnswer(userIndex, btnRef) {
        const state = gameState[currentTab];
        const q = state.list[state.idx];
        let isCorrect = false;

        // é€»è¾‘åˆ¤æ–­
        if (currentTab === 'fact') {
            isCorrect = (userIndex === q.type); 
            Array.from(document.getElementById('fact-btns').children).forEach(b => {
                b.disabled = true;
                b.style.opacity = '0.6';
            });
        } else {
            isCorrect = (userIndex === q.correct);
            Array.from(document.getElementById('opt-btns').children).forEach(b => {
                b.disabled = true;
                b.style.cursor = 'default';
            });
            // é¢œè‰²æ ‡è®°
            if (isCorrect) {
                btnRef.style.background = '#e8f8f5';
                btnRef.style.borderColor = '#2ecc71';
            } else {
                btnRef.style.background = '#fdedec';
                btnRef.style.borderColor = '#e74c3c';
                // æ˜¾ç¤ºæ­£ç¡®é¡¹
                const opts = document.getElementById('opt-btns').children;
                opts[q.correct].style.background = '#e8f8f5';
                opts[q.correct].style.borderColor = '#2ecc71';
            }
        }

        // è®¡åˆ†
        if (isCorrect) {
            globalScore += 1;
            document.getElementById('global-score').innerText = globalScore;
        }

        // åé¦ˆä¿¡æ¯
        const fb = document.getElementById('feedback');
        fb.style.display = 'block';
        fb.className = isCorrect ? 'feedback-box correct' : 'feedback-box wrong';
        fb.innerHTML = `<strong>${isCorrect ? 'ğŸ‰ ç­”å¯¹äº†ï¼' : 'ğŸ˜… ç­”é”™äº†'}</strong><div class="explain-text">${q.explain}</div>`;
        
        document.getElementById('next-btn').style.display = 'block';

        // è¿›åº¦æ¡æ»¡æ ¼
        document.getElementById('progress-bar').style.width = `${((state.idx + 1)/state.list.length)*100}%`;
    }

    function nextQuestion() {
        const state = gameState[currentTab];
        state.idx++;
        
        if (state.idx >= state.list.length) {
            state.finished = true;
            document.querySelector(`.nav-btn[data-tab="${currentTab}"]`).classList.add('finished');
            
            if (gameState.fact.finished && gameState.wolf.finished && gameState.logic.finished) {
                calculateFinalReward();
            } else {
                document.getElementById('game-card').style.display = 'none';
                document.getElementById('done-card').style.display = 'block';
            }
        } else {
            renderQuestion();
        }
    }

    function calculateFinalReward() {
        document.getElementById('game-card').style.display = 'none';
        document.getElementById('done-card').style.display = 'none';
        document.getElementById('coupon-card').style.display = 'block';

        // è®¡ç®—é€»è¾‘
        const totalQ = 40;
        const wrongCount = totalQ - globalScore;
        let finalTime = globalScore;
        let msg = "";
        let showBonus = false;

        // è§„åˆ™ï¼š
        // 1. å…¨å¯¹(40åˆ†) -> 60åˆ†é’Ÿ (å¥–åŠ±20åˆ†)
        // 2. é”™2é“ä»¥å†…(>=38åˆ†) -> å¾—åˆ†+10åˆ†é’Ÿ
        // 3. å…¶ä»– -> å¾—åˆ†å¤šå°‘æ˜¯å¤šå°‘

        if (globalScore === 40) {
            finalTime = 60;
            msg = "å®Œç¾é€šå…³ï¼è§¦å‘è¶…çº§å¤§å¥–ï¼šé¢å¤–+20åˆ†é’Ÿï¼";
            showBonus = true;
        } else if (globalScore >= 38) {
            finalTime = globalScore + 10;
            msg = "è¡¨ç°ä¼˜ç§€ï¼ˆé”™é¢˜â‰¤2ï¼‰ï¼Œè§¦å‘é¼“åŠ±å¥–ï¼šé¢å¤–+10åˆ†é’Ÿï¼";
            showBonus = true;
        } else {
            msg = "ç»§ç»­åŠ æ²¹ï¼ä¸‹æ¬¡äº‰å–æ‹¿å…¨å¯¹å¥–åŠ±ï¼";
        }

        document.getElementById('raw-score').innerText = globalScore;
        document.getElementById('final-minutes').innerText = finalTime;
        document.getElementById('reward-explain').innerText = msg;
        
        if (showBonus) {
            document.getElementById('bonus-msg').style.display = 'inline-block';
        }
    }

    // åˆå§‹åŒ–
    renderQuestion();

</script>

</body>
</html>
