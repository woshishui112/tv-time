<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æœ€å¼ºè„‘åŠ›æŒ‘æˆ˜ (6å¹´çº§å°‘å„¿ç‰ˆ)</title>
    <style>
        :root { 
            --primary: #4a90e2; /* é¢œè‰²æ”¹å¾—æ›´æ´»æ³¼ä¸€ç‚¹ */
            --wolf: #9b59b6; 
            --fact: #2ecc71; 
            --logic: #e67e22; 
            --bg: #f4f7f6; 
            --card: #ffffff; 
            --green: #27ae60;
            --red: #e74c3c;
            --orange: #f39c12;
            --timer-bg: #e0e0e0;
        }
        body { font-family: 'Comic Sans MS', 'Segoe UI', 'Microsoft YaHei', sans-serif; background: var(--bg); color: #2c3e50; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; min-height: 100vh; user-select: none; }
        
        /* é¡¶éƒ¨çœ‹æ¿ */
        header { 
            width: 100%; max-width: 650px; margin-bottom: 20px; 
            background: linear-gradient(135deg, var(--primary), #5dade2);
            color: white; padding: 20px; border-radius: 20px;
            box-shadow: 0 8px 20px rgba(74, 144, 226, 0.3);
            display: flex; justify-content: space-between; align-items: center;
        }
        
        .title-area h1 { margin: 0; font-size: 1.6rem; letter-spacing: 1px; }
        .title-area p { margin: 5px 0 0; opacity: 0.95; font-size: 0.95rem; color: #fff; }
        .score-box { text-align: right; background: rgba(255,255,255,0.2); padding: 10px 15px; border-radius: 12px; }
        .score-num { font-size: 2.2rem; font-weight: bold; color: #fff; line-height: 1; text-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .score-label { font-size: 0.8rem; opacity: 1; }

        /* å¯¼èˆª */
        nav { display: flex; gap: 10px; margin-bottom: 20px; justify-content: center; width: 100%; max-width: 650px; }
        .nav-btn { 
            flex: 1; padding: 12px; border: none; background: white; border-radius: 12px; 
            cursor: pointer; font-weight: bold; color: #bdc3c7; font-size: 0.95rem;
            transition: all 0.2s; box-shadow: 0 4px 10px rgba(0,0,0,0.05); position: relative; overflow: hidden;
        }
        .nav-btn.active { color: white; transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .nav-btn[data-tab="fact"].active { background: var(--fact); }
        .nav-btn[data-tab="wolf"].active { background: var(--wolf); }
        .nav-btn[data-tab="logic"].active { background: var(--logic); }
        .nav-btn.finished::after { content: 'ğŸŒŸ'; position: absolute; right: 5px; top: 5px; font-size: 0.8rem; }
        .nav-btn.finished { opacity: 0.8; background: #95a5a6 !important; color: #fff; text-decoration: line-through; }

        /* ä¸»å¡ç‰‡ */
        main { width: 100%; max-width: 650px; position: relative; perspective: 1000px; }
        .card { background: var(--card); padding: 30px; border-radius: 25px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); display: none; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
        .card.active { display: block; }
        @keyframes popIn { from { opacity: 0; transform: scale(0.95); } to { opacity: 1; transform: scale(1); } }

        /* è®¡æ—¶å™¨æ¡ */
        .timer-container {
            width: 100%; height: 10px; background: var(--timer-bg); border-radius: 5px; 
            margin-bottom: 25px; overflow: hidden; position: relative;
        }
        .timer-bar {
            height: 100%; width: 100%; background: var(--green);
            transform-origin: left; transition: width 1s linear, background 0.3s;
            border-radius: 5px;
        }

        /* é¢˜ç›®åŒºåŸŸ */
        .header-row { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; font-size: 1rem; color: #7f8c8d; font-weight: bold; }
        .q-text { font-size: 1.5rem; font-weight: 700; line-height: 1.5; margin: 10px 0 30px; color: #2c3e50; min-height: 60px; }
        
        /* é€‰é¡¹æŒ‰é’® */
        .options-grid { display: grid; gap: 15px; }
        .btn-opt { 
            padding: 20px; border: 3px solid #ecf0f1; background: white; border-radius: 18px; 
            cursor: pointer; font-size: 1.2rem; text-align: left; transition: 0.2s; font-weight: 600; color: #576574; position: relative;
        }
        .btn-opt:hover { border-color: var(--primary); background: #f0f8ff; transform: translateX(5px); }
        .btn-opt:active { transform: scale(0.98); }
        
        .fact-btns { display: flex; gap: 20px; }
        .fact-btns button { flex: 1; padding: 25px; font-size: 1.3rem; border: none; border-radius: 18px; cursor: pointer; color: white; font-weight: bold; box-shadow: 0 5px 0 rgba(0,0,0,0.1); transition: transform 0.1s; }
        .fact-btns button:active { transform: translateY(5px); box-shadow: none; }
        .btn-f { background: var(--fact); }
        .btn-o { background: var(--orange); }

        /* åé¦ˆ */
        .feedback-box { margin-top: 25px; padding: 20px; border-radius: 18px; display: none; text-align: center; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        .feedback-box.correct { background: #e8f8f5; border: 2px solid #a2d9ce; color: #16a085; }
        .feedback-box.wrong { background: #fdedec; border: 2px solid #fadbd8; color: #c0392b; }
        .feedback-box.timeout { background: #ebf5fb; border: 2px solid #aed6f1; color: #2e86c1; } 
        
        .explain-text { font-size: 1.1rem; margin-top: 10px; text-align: left; background: rgba(255,255,255,0.7); padding: 12px; border-radius: 10px; line-height: 1.5; }

        .next-btn { 
            margin-top: 25px; width: 100%; padding: 20px; 
            background: var(--primary); color: white; 
            border: none; border-radius: 18px; 
            cursor: pointer; font-size: 1.3rem; font-weight: bold; letter-spacing: 1px;
            display: none; box-shadow: 0 5px 0 #2980b9;
        }
        .next-btn:active { transform: translateY(5px); box-shadow: none; }

        /* ç»“ç®—å¡ç‰‡ */
        .coupon { background: #fff; border: 5px dashed var(--primary); text-align: center; padding: 40px 20px; }
        .coupon-val { font-size: 5.5rem; font-weight: 800; color: var(--primary); margin: 15px 0; text-shadow: 3px 3px 0px rgba(0,0,0,0.1); }
        .bonus-tag { background: var(--red); color: white; padding: 10px 25px; border-radius: 30px; font-size: 1.1rem; display: inline-block; margin-bottom: 15px; font-weight: bold; box-shadow: 0 4px 10px rgba(192, 57, 43, 0.4); }

        /* æ‰‹æœºé€‚é… */
        @media (max-width: 480px) {
            .title-area h1 { font-size: 1.3rem; }
            .q-text { font-size: 1.2rem; }
            .btn-opt { padding: 15px; font-size: 1.1rem; }
        }
    </style>
</head>
<body>

<header>
    <div class="title-area">
        <h1>ğŸš€ æœ€å¼ºè„‘åŠ›æŒ‘æˆ˜</h1>
        <p>6å¹´çº§ä¸“å± | é€»è¾‘Â·æ•°å­¦Â·å¸¸è¯†</p>
    </div>
    <div class="score-box">
        <div class="score-label">æ€»å¾—åˆ†</div>
        <div><span class="score-num" id="global-score">0</span> <span style="font-size:1rem">åˆ†</span></div>
    </div>
</header>

<nav>
    <button class="nav-btn active" id="nav-fact" data-tab="fact" onclick="switchTab('fact')">1. ç§‘å­¦å¸¸è¯† (15é¢˜)</button>
    <button class="nav-btn" id="nav-wolf" data-tab="wolf" onclick="switchTab('wolf')">2. é€»è¾‘ä¾¦æ¢ (15é¢˜)</button>
    <button class="nav-btn" id="nav-logic" data-tab="logic" onclick="switchTab('logic')">3. æ•°å­¦æ€ç»´ (20é¢˜)</button>
</nav>

<main>
    <div id="game-card" class="card active">
        <div class="header-row">
            <span id="progress-text">é¢˜ç›® 1 / 15</span>
            <div style="position: relative; width: 80px; text-align: right;">
                â±ï¸ <span id="timer-num">25</span>s
            </div>
        </div>
        
        <div class="timer-container">
            <div class="timer-bar" id="timer-bar"></div>
        </div>

        <div id="question-area">
            <div class="q-text" id="q-text">é¢˜ç›®åŠ è½½ä¸­...</div>
            
            <div class="fact-btns" id="fact-btns" style="display:none;">
                <button class="btn-f" onclick="checkAnswer('fact')">âœ… æ˜¯äº‹å® (Fact)</button>
                <button class="btn-o" onclick="checkAnswer('opinion')">ğŸ¤” æ˜¯è§‚ç‚¹ (Opinion)</button>
            </div>

            <div class="options-grid" id="opt-btns" style="display:none;"></div>
        </div>

        <div id="feedback" class="feedback-box"></div>
        <button class="next-btn" id="next-btn" onclick="nextQuestion()">ä¸‹ä¸€é¢˜ â¡ï¸</button>
    </div>

    <div id="done-card" class="card" style="text-align:center; padding:50px 20px;">
        <h2 style="color:var(--fact); font-size:2.2rem; margin-bottom:10px;">ğŸ‰ æ­å–œé€šå…³ï¼</h2>
        <div style="font-size:5rem; margin:20px 0;">ğŸŒŸ</div>
        <p style="font-size:1.3rem; color:#7f8c8d;">ä¼‘æ¯ä¸€ä¸‹ï¼Œç‚¹å‡»ä¸Šæ–¹æŒ‰é’®<br>è¿›å…¥ä¸‹ä¸€å…³æŒ‘æˆ˜å§ï¼</p>
    </div>

    <div id="coupon-card" class="card coupon">
        <div id="bonus-msg" class="bonus-tag" style="display:none;">ğŸ‰ è§¦å‘è¶…çº§å¥–åŠ±ï¼</div>
        <h2 style="color:#2c3e50; margin:0;">âœ¨ ç”µè§†/æ¸¸æˆæ—¶é—´å…‘æ¢åˆ¸ âœ¨</h2>
        <div class="coupon-val"><span id="final-minutes">0</span> åˆ†é’Ÿ</div>
        <div class="coupon-note">
            åŸå§‹å¾—åˆ†: <span id="raw-score">0</span>/50<br>
            <span id="reward-explain" style="font-size:1rem; line-height:1.6; display:block; margin-top:15px; color:#555;"></span>
        </div>
        <button onclick="location.reload()" style="margin-top:30px; padding:15px 30px; background:#95a5a6; border:none; border-radius:12px; cursor:pointer; color:white; font-weight:bold; font-size:1.1rem;">ğŸ”„ æ˜å¤©å†æ¥æŒ‘æˆ˜</button>
    </div>
</main>

<script>
    // ==========================================
    // â¬‡ï¸ é™æ€é¢˜åº“ (6å¹´çº§éš¾åº¦ï¼šè¯¾æœ¬å¸¸è¯†ä¸åŸºç¡€é€»è¾‘)
    // ==========================================

    const staticFactDB = [
        // ç§‘å­¦ä¸å¸¸è¯† (ç»“åˆå°å­¦è‡ªç„¶/ç§‘å­¦è¯¾)
        { t: "fact", q: "æ¤ç‰©é€šè¿‡å…‰åˆä½œç”¨ï¼Œå¸æ”¶äºŒæ°§åŒ–ç¢³ï¼Œé‡Šæ”¾æ°§æ°”ã€‚", e: "è¿™æ˜¯æ¤ç‰©ç”Ÿå­˜çš„åŸºæœ¬åŸç†ã€‚" },
        { t: "fact", q: "åœ°çƒç»•å¤ªé˜³å…¬è½¬ä¸€å‘¨å¤§çº¦éœ€è¦365å¤©ã€‚", e: "è¿™å°±æ˜¯â€˜ä¸€å¹´â€™çš„ç”±æ¥ã€‚" },
        { t: "fact", q: "ä¼é¹…æ˜¯é¸Ÿç±»ï¼Œä½†å®ƒä»¬ä¸ä¼šé£ã€‚", e: "äº‹å®ï¼Œå®ƒä»¬æ˜¯æ¸¸æ³³é«˜æ‰‹ã€‚" },
        { t: "fact", q: "æœˆçƒæœ¬èº«ä¸å‘å…‰ï¼Œæˆ‘ä»¬çœ‹åˆ°çš„æ˜¯å®ƒåå°„çš„å¤ªé˜³å…‰ã€‚", e: "æœˆçƒæ˜¯å«æ˜Ÿï¼Œä¸æ˜¯æ’æ˜Ÿã€‚" },
        { t: "fact", q: "æ°´åœ¨0æ‘„æ°åº¦ä»¥ä¸‹ä¼šç»“å†°ï¼ˆæ ‡å‡†å¤§æ°”å‹ï¼‰ã€‚", e: "è¿™æ˜¯æ°´çš„ç‰©ç†æ€§è´¨ã€‚" },
        { t: "fact", q: "äººä½“å…±æœ‰206å—éª¨å¤´ï¼ˆæˆå¹´äººï¼‰ã€‚", e: "è§£å‰–å­¦äº‹å®ã€‚" },
        { t: "fact", q: "ä¸­å›½å†å²ä¸Šç¬¬ä¸€ä¸ªçš‡å¸æ˜¯ç§¦å§‹çš‡ã€‚", e: "å†å²äº‹å®ã€‚" },
        { t: "fact", q: "å£°éŸ³åœ¨çœŸç©ºä¸­æ— æ³•ä¼ æ’­ã€‚", e: "å£°éŸ³éœ€è¦ä»‹è´¨ï¼ˆå¦‚ç©ºæ°”ã€æ°´ï¼‰ã€‚" },
        { t: "fact", q: "ä¸‰è§’å½¢çš„å†…è§’å’Œæ°¸è¿œæ˜¯180åº¦ã€‚", e: "å¹³é¢å‡ ä½•çš„åŸºæœ¬å®šç†ã€‚" },
        { t: "fact", q: "é²¸é±¼ç”¨è‚ºå‘¼å¸ï¼Œä¸æ˜¯ç”¨é³ƒã€‚", e: "å› ä¸ºé²¸é±¼æ˜¯å“ºä¹³åŠ¨ç‰©ã€‚" },
        
        // è§‚ç‚¹ (åŒºåˆ†äº‹å®ä¸çœ‹æ³•)
        { t: "opinion", q: "æ•°å­¦æ˜¯æ‰€æœ‰ç§‘ç›®é‡Œæœ€éš¾å­¦çš„ã€‚", e: "æœ‰äººè§‰å¾—éš¾ï¼Œæœ‰äººè§‰å¾—ç®€å•ï¼Œè¿™æ˜¯ä¸ªäººçœ‹æ³•ã€‚" },
        { t: "opinion", q: "å¤å¤©æ¯”å†¬å¤©æ›´èˆ’æœã€‚", e: "æ€•çƒ­çš„äººå¯èƒ½æ›´å–œæ¬¢å†¬å¤©ã€‚" },
        { t: "opinion", q: "å·§å…‹åŠ›å£å‘³çš„å†°æ·‡æ·‹æ˜¯æœ€å¥½åƒçš„ã€‚", e: "å£å‘³å› äººè€Œå¼‚ã€‚" },
        { t: "opinion", q: "åªè¦åŠªåŠ›ï¼Œå°±ä¸€å®šèƒ½è€ƒ100åˆ†ã€‚", e: "è¿™æ˜¯ä¸€ç§ä¿¡å¿µæˆ–é¼“åŠ±ï¼Œä¸æ˜¯å¿…ç„¶å‘ç”Ÿçš„å®¢è§‚è§„å¾‹ã€‚" },
        { t: "opinion", q: "å°å­¦ç”Ÿä¸åº”è¯¥æœ‰å®¶åº­ä½œä¸šã€‚", e: "è¿™æ˜¯å…³äºæ•™è‚²æ–¹å¼çš„è§‚ç‚¹è®¨è®ºã€‚" },
        { t: "opinion", q: "è¿™å¹…ç”»å¤ªä¸‘äº†ã€‚", e: "å®¡ç¾æ˜¯ä¸»è§‚çš„ã€‚" }
    ];

    const staticWolfDB = [
        // é€»è¾‘åˆ¤æ–­ (é€‚åˆ11-12å²)
        { q: "å°æ˜è¯´ï¼š'æˆ‘æ¯”å“¥å“¥å°2å²ï¼Œå“¥å“¥æ¯”æˆ‘å¤§2å²'ã€‚ä»–è¯´å¾—å¯¹å—ï¼Ÿ", o: ["å¯¹", "ä¸å¯¹"], c: 0, e: "é€»è¾‘æ­£ç¡®ï¼Œæ˜¯ç›¸å¯¹çš„å…³ç³»ã€‚" },
        { q: "Aè¯´ï¼š'æ‰€æœ‰çš„å¶æ•°éƒ½èƒ½è¢«2æ•´é™¤'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº (çœŸè¯)", "ç‹¼äºº (å‡è¯)"], c: 0, e: "è¿™æ˜¯å¶æ•°çš„å®šä¹‰ã€‚" },
        { q: "Aè¯´ï¼š'å› ä¸ºä»Šå¤©æ˜¯å‘¨ä¸€ï¼Œæ‰€ä»¥æ˜å¤©ä¸€å®šæ˜¯å‘¨äºŒ'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº (çœŸè¯)", "ç‹¼äºº (å‡è¯)"], c: 0, e: "æ—¶é—´é¡ºåºæ˜¯å›ºå®šçš„ã€‚" },
        { q: "Aè¯´ï¼š'æˆ‘æŠŠä¸€å—çŸ³å¤´æ‰”è¿›æ°´é‡Œï¼ŒçŸ³å¤´æµ®èµ·æ¥äº†'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "çŸ³å¤´å¯†åº¦æ¯”æ°´å¤§ï¼Œé€šå¸¸ä¼šæ²‰ä¸‹å»ï¼ˆé™¤éæ˜¯æµ®çŸ³ï¼Œä½†ä¸€èˆ¬æƒ…å†µè§†ä¸ºè°è¨€ï¼‰ã€‚" },
        { q: "Aè¯´ï¼š'å¤ªé˜³ä»è¥¿è¾¹å‡èµ·'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "å¤ªé˜³ä»ä¸œè¾¹å‡èµ·ã€‚" },
        { q: "Aè¯´ï¼š'æˆ‘æœ‰3ä¸ªè‹¹æœï¼Œåƒæ‰äº†1ä¸ªï¼Œè¿˜å‰©2ä¸ª'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "3-1=2ï¼Œè®¡ç®—æ­£ç¡®ã€‚" },
        { q: "Aè¯´ï¼š'å…¬é¸¡ä¸‹äº†ä¸€ä¸ªè›‹'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "å…¬é¸¡ä¸ä¼šä¸‹è›‹ã€‚" },
        { q: "Aè¯´ï¼š'ä¸€å¹´æœ‰13ä¸ªæœˆ'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "é€šå¸¸ä¸€å¹´æ˜¯12ä¸ªæœˆã€‚" },
        { q: "Aè¯´ï¼š'å¦‚æœå¤©ä¸‹é›¨ï¼Œåœ°ä¸Šé€šå¸¸ä¼šæ¹¿'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 0, e: "ç¬¦åˆå› æœé€»è¾‘ã€‚" },
        { q: "Aè¯´ï¼š'æˆ‘çš„èº«é«˜æ˜¯3ç±³'ã€‚Aæ˜¯å¥½äººè¿˜æ˜¯ç‹¼äººï¼Ÿ", o: ["å¥½äºº", "ç‹¼äºº"], c: 1, e: "äººç±»ä¸å¯èƒ½é•¿åˆ°3ç±³é«˜ã€‚" }
    ];

    // ==========================================
    // â¬‡ï¸ åŠ¨æ€é¢˜ç›®ç”Ÿæˆå¼•æ“ (6å¹´çº§å®šåˆ¶ç‰ˆ)
    // ==========================================

    // ğŸ› ï¸ æ ¸å¿ƒå·¥å…·ï¼šè‡ªåŠ¨æ´—ç‰Œå¹¶ä¿®æ­£ç´¢å¼•ï¼ˆä¿®å¤ä¹‹å‰çš„Bugï¼‰
    function makeQ(text, correctVal, wrongList, explain) {
        let allOpts = [correctVal, ...wrongList];
        let shuffled = shuffleArray(allOpts);
        let correctIdx = shuffled.indexOf(correctVal);
        return { text: text, options: shuffled, correct: correctIdx, explain: explain };
    }

    // ğŸ”¥ 1. æ•°åˆ—æ‰¾è§„å¾‹ (6å¹´çº§æ•°å­¦ï¼šå¹³æ–¹ã€å°æ•°ã€æ–æ³¢é‚£å¥‘)
    function genSequence() {
        const type = Math.floor(Math.random() * 5); 
        
        if (type === 0) { // ç®€å•ç­‰å·® (ä¾‹: 5, 8, 11...)
            let start = Math.floor(Math.random() * 20) + 1;
            let diff = Math.floor(Math.random() * 8) + 2;
            let nums = [start, start+diff, start+diff*2, start+diff*3];
            let ans = start+diff*4;
            return makeQ(
                `æ‰¾è§„å¾‹ï¼š${nums.join(', ')}, ?`,
                ans.toString(),
                [(ans-1).toString(), (ans+2).toString()],
                `è¿™æ˜¯ç­‰å·®æ•°åˆ—ï¼Œæ¯æ¬¡åŠ  ${diff}ã€‚`
            );
        } 
        else if (type === 1) { // ç®€å•ç­‰æ¯” (ä¾‹: 2, 4, 8, 16)
            let start = Math.floor(Math.random() * 3) + 1;
            let ratio = Math.floor(Math.random() * 2) + 2; // x2 æˆ– x3
            let nums = [start, start*ratio, start*ratio*ratio, start*ratio*ratio*ratio];
            let ans = nums[3] * ratio;
            return makeQ(
                `æ‰¾è§„å¾‹ï¼š${nums.join(', ')}, ?`,
                ans.toString(),
                [(ans+ratio).toString(), (ans/2).toString()],
                `æ¯æ¬¡ä¹˜ä»¥ ${ratio}ã€‚`
            );
        }
        else if (type === 2) { // å¹³æ–¹æ•° (ä¾‹: 1, 4, 9, 16...) 6å¹´çº§å¿…èƒŒ
            let start = Math.floor(Math.random() * 5) + 1; 
            let nums = [];
            for(let i=0; i<4; i++) nums.push((start+i)*(start+i));
            let nextNum = start+4;
            let ans = nextNum * nextNum;
            return makeQ(
                `æ‰¾è§„å¾‹ï¼š${nums.join(', ')}, ?`,
                ans.toString(),
                [(ans-5).toString(), (ans+10).toString()],
                `è¿™æ˜¯å¹³æ–¹æ•°æ•°åˆ—ï¼š${start}Â², ${start+1}Â², ${start+2}Â²... ä¸‹ä¸€ä¸ªæ˜¯ ${nextNum}Â² = ${ans}ã€‚`
            );
        }
        else if (type === 3) { // é€’å¢ç›¸åŠ  (ä¾‹: 1, 2, 4, 7... +1,+2,+3)
            let current = Math.floor(Math.random() * 10) + 5;
            let nums = [current];
            // ç”Ÿæˆ: +1, +2, +3
            for(let i=1; i<=3; i++) {
                current = current + i;
                nums.push(current);
            }
            let ans = nums[3] + 4; // ä¸‹ä¸€ä¸ªè¦+4
            return makeQ(
                `æ‰¾è§„å¾‹ï¼š${nums.join(', ')}, ?`,
                ans.toString(),
                [(ans-1).toString(), (ans+2).toString()],
                `å¢åŠ çš„æ•°å­—åœ¨å˜å¤§ï¼š+1, +2, +3ï¼Œæ‰€ä»¥ä¸‹ä¸€ä¸ªè¦ +4ã€‚`
            );
        }
        else { // å°æ•°æ•°åˆ— (ä¾‹: 1.5, 2.0, 2.5...)
            let start = Math.floor(Math.random() * 5);
            let nums = [start + 0.5, start + 1.0, start + 1.5, start + 2.0];
            let ans = (start + 2.5).toFixed(1);
            return makeQ(
                `æ‰¾è§„å¾‹ï¼š${nums.join(', ')}, ?`,
                ans.toString(),
                [(start+3.0).toFixed(1), (start+2.4).toFixed(1)],
                `æ¯æ¬¡å¢åŠ  0.5ã€‚`
            );
        }
    }

    // ğŸ”¥ 2. æ—¥æœŸå‘¨æœŸ (å‘¨æœŸé—®é¢˜ï¼šä½™æ•°)
    function genDateLogic() {
        const days = ["å‘¨ä¸€", "å‘¨äºŒ", "å‘¨ä¸‰", "å‘¨å››", "å‘¨äº”", "å‘¨å…­", "å‘¨æ—¥"];
        const idx = Math.floor(Math.random() * 7);
        const diff = Math.floor(Math.random() * 20) + 2; // 2-22å¤©å
        
        const targetDay = days[(idx + diff) % 7];
        
        return makeQ(
            `å¦‚æœä»Šå¤©æ˜¯${days[idx]}ï¼Œé‚£ä¹ˆ ${diff} å¤©åæ˜¯æ˜ŸæœŸå‡ ï¼Ÿ`,
            targetDay,
            [days[(idx + diff + 1) % 7], days[(idx + diff + 2) % 7]],
            `${diff} Ã· 7 = ${Math.floor(diff/7)} ä½™ ${diff%7}ã€‚ä»${days[idx]}å¾€åæ¨${diff%7}å¤©æ˜¯${targetDay}ã€‚`
        );
    }

    // ğŸ”¥ 3. é€»è¾‘æ¯”è¾ƒ (ä¸‰æ®µè®º)
    function genComparison() {
        // ç”² > ä¹™ > ä¸™
        let p1 = "ç”²"; let p2 = "ä¹™"; let p3 = "ä¸™";
        if(Math.random() > 0.5) { p1="å°çº¢"; p2="å°æ˜"; p3="å°åˆš"; }

        let qText = `å·²çŸ¥ï¼š${p1}æ¯”${p2}é«˜ï¼Œ${p2}æ¯”${p3}é«˜ã€‚<br>è°æœ€çŸ®ï¼Ÿ`;
        let correct = p3;
        let explain = `${p1}æœ€é«˜ï¼Œ${p2}ä¸­é—´ï¼Œ${p3}æœ€çŸ®ã€‚`;

        return makeQ(qText, correct, [p1, p2], explain);
    }

    // ğŸ”¥ 4. æ•°å­¦åº”ç”¨ (ç®€å•çš„ä¹˜é™¤æˆ–å‰©ä½™)
    function genMathWord() {
        const type = Math.random();
        if(type < 0.5) {
            // å•ä»·é—®é¢˜
            let price = Math.floor(Math.random() * 10) + 5; // 5-15å…ƒ
            let count = Math.floor(Math.random() * 5) + 3;  // 3-8ä¸ª
            let total = price * count;
            return makeQ(
                `ä¸€æ”¯ç¬”${price}å…ƒï¼Œä¹°${count}æ”¯éœ€è¦å¤šå°‘é’±ï¼Ÿ`,
                total.toString() + "å…ƒ",
                [(total-5)+"å…ƒ", (total+price)+"å…ƒ"],
                `å•ä»· Ã— æ•°é‡ = æ€»ä»·ï¼š${price} Ã— ${count} = ${total}ã€‚`
            );
        } else {
            // å‰©ä½™é—®é¢˜
            let total = 50;
            let cost = Math.floor(Math.random() * 5) + 4; // æ¯æ¬¡ç”¨4-9
            let times = 3;
            let left = total - (cost * times);
            return makeQ(
                `æœ‰50å…ƒï¼Œä¹°é›¶é£Ÿæ¯æ¬¡èŠ±${cost}å…ƒï¼Œä¹°äº†${times}æ¬¡åè¿˜å‰©å¤šå°‘å…ƒï¼Ÿ`,
                left.toString() + "å…ƒ",
                [(left+2)+"å…ƒ", (total-cost)+"å…ƒ"],
                `å…ˆç®—èŠ±æ‰çš„ï¼š${cost}Ã—${times}=${cost*times}å…ƒã€‚å†ç®—å‰©ä¸‹çš„ï¼š50-${cost*times}=${left}å…ƒã€‚`
            );
        }
    }

    // ç”Ÿæˆæ··åˆé¢˜åº“
    function generateLogicPool(count) {
        const pool = [];
        for(let i=0; i<count; i++) {
            const rand = Math.random();
            let q;
            if (rand < 0.35) q = genSequence(); // æ•°åˆ—
            else if (rand < 0.55) q = genDateLogic(); // æ—¥æœŸ
            else if (rand < 0.75) q = genMathWord(); // åº”ç”¨é¢˜
            else q = genComparison(); // é€»è¾‘
            pool.push(q);
        }
        return pool;
    }

    // ==========================================
    // â¬‡ï¸ æ¸¸æˆæ§åˆ¶ç³»ç»Ÿ
    // ==========================================

    let gameState = {
        fact: { idx: 0, list: [], finished: false },
        wolf: { idx: 0, list: [], finished: false },
        logic: { idx: 0, list: [], finished: false }
    };
    let globalScore = 0;
    let currentTab = 'fact';
    let timerInterval;
    const TIME_LIMIT = 25; // 6å¹´çº§ç»™25ç§’ï¼Œæ¯”è¾ƒå……è£•

    function shuffleArray(array) {
        let arr = JSON.parse(JSON.stringify(array));
        for (let i = arr.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [arr[i], arr[j]] = [arr[j], arr[i]];
        }
        return arr;
    }

    function initGame() {
        // 1. äº‹å®é¢˜
        let fullFact = shuffleArray(staticFactDB);
        while(fullFact.length < 15) fullFact = fullFact.concat(shuffleArray(staticFactDB));
        gameState.fact.list = fullFact.slice(0, 15);

        // 2. ç‹¼äººé¢˜
        let fullWolf = shuffleArray(staticWolfDB);
        while(fullWolf.length < 15) fullWolf = fullWolf.concat(shuffleArray(staticWolfDB));
        gameState.wolf.list = fullWolf.slice(0, 15);

        // 3. é€»è¾‘é¢˜ (åŠ¨æ€ç”Ÿæˆ)
        gameState.logic.list = generateLogicPool(20);
        
        console.log("6å¹´çº§é¢˜åº“åŠ è½½å®Œæ¯•ã€‚");
        
        globalScore = 0;
        document.getElementById('global-score').innerText = "0";
        renderQuestion();
    }

    function switchTab(tab) {
        currentTab = tab;
        clearInterval(timerInterval); 
        
        // UI æ›´æ–°
        document.querySelectorAll('.nav-btn').forEach(btn => btn.classList.remove('active'));
        document.querySelector(`.nav-btn[data-tab="${tab}"]`).classList.add('active');
        
        document.getElementById('game-card').style.display = 'none';
        document.getElementById('done-card').style.display = 'none';
        document.getElementById('coupon-card').style.display = 'none';

        if (gameState.fact.finished && gameState.wolf.finished && gameState.logic.finished) {
            calculateFinalReward();
            return;
        }

        if (gameState[tab].finished) {
            document.getElementById('done-card').style.display = 'block';
        } else {
            document.getElementById('game-card').style.display = 'block';
            renderQuestion(); 
        }
    }

    function startTimer() {
        clearInterval(timerInterval);
        let timeLeft = TIME_LIMIT;
        const timerBar = document.getElementById('timer-bar');
        const timerNum = document.getElementById('timer-num');
        
        timerBar.style.transition = 'none';
        timerBar.style.width = '100%';
        timerBar.style.backgroundColor = 'var(--green)';
        timerNum.innerText = timeLeft;
        timerNum.style.color = '#2c3e50';

        timerBar.offsetHeight; 

        timerBar.style.transition = `width ${TIME_LIMIT}s linear`;
        timerBar.style.width = '0%';

        timerInterval = setInterval(() => {
            timeLeft--;
            timerNum.innerText = timeLeft;
            
            if(timeLeft <= 5) {
                timerBar.style.backgroundColor = 'var(--red)';
                timerNum.style.color = 'var(--red)';
            } else if (timeLeft <= 10) {
                timerBar.style.backgroundColor = 'var(--orange)';
            }

            if (timeLeft <= 0) {
                clearInterval(timerInterval);
                handleTimeout();
            }
        }, 1000);
    }

    function stopTimer() {
        clearInterval(timerInterval);
        const timerBar = document.getElementById('timer-bar');
        const computedStyle = window.getComputedStyle(timerBar);
        const w = computedStyle.getPropertyValue('width');
        timerBar.style.transition = 'none';
        timerBar.style.width = w;
    }

    function handleTimeout() {
        const state = gameState[currentTab];
        const q = state.list[state.idx];
        disableAllButtons();
        
        const fb = document.getElementById('feedback');
        fb.style.display = 'block';
        fb.className = 'feedback-box timeout';
        
        let ansText = "";
        if(currentTab === 'fact') ansText = q.t === 'fact' ? "äº‹å®" : "è§‚ç‚¹";
        else if(currentTab === 'wolf') ansText = q.o[q.c];
        else ansText = q.options[q.correct];

        fb.innerHTML = `<strong>â° æ—¶é—´åˆ°å•¦ï¼</strong><br>åˆ«ç°å¿ƒï¼Œä¸‹æ¬¡å¿«ä¸€ç‚¹ï¼<div class="explain-text">æ­£ç¡®ç­”æ¡ˆæ˜¯ï¼š${ansText}<br>${q.e || q.explain}</div>`;
        
        document.getElementById('next-btn').style.display = 'block';
    }

    function renderQuestion() {
        const state = gameState[currentTab];
        const q = state.list[state.idx];
        const total = state.list.length;

        document.getElementById('progress-text').innerText = `ç¬¬ ${state.idx + 1} é¢˜ / å…± ${total} é¢˜`;
        document.getElementById('q-text').innerHTML = q.q || q.text; 
        
        document.getElementById('feedback').style.display = 'none';
        document.getElementById('next-btn').style.display = 'none';
        
        const factGroup = document.getElementById('fact-btns');
        const optGroup = document.getElementById('opt-btns');

        if (currentTab === 'fact') {
            factGroup.style.display = 'flex';
            optGroup.style.display = 'none';
            Array.from(factGroup.children).forEach(btn => {
                btn.disabled = false;
                btn.style.opacity = '1';
                btn.style.transform = 'scale(1)';
            });
        } else {
            factGroup.style.display = 'none';
            optGroup.style.display = 'grid';
            optGroup.innerHTML = '';
            
            const opts = q.o || q.options;
            opts.forEach((opt, i) => {
                const btn = document.createElement('button');
                btn.className = 'btn-opt';
                btn.innerText = opt;
                btn.onclick = () => checkAnswer(i, btn);
                optGroup.appendChild(btn);
            });
        }

        startTimer();
    }

    function disableAllButtons() {
        if (currentTab === 'fact') {
            Array.from(document.getElementById('fact-btns').children).forEach(b => {
                b.disabled = true;
                b.style.opacity = '0.6';
            });
        } else {
            Array.from(document.getElementById('opt-btns').children).forEach(b => {
                b.disabled = true;
                b.style.cursor = 'default';
            });
        }
    }

    function checkAnswer(userIndex, btnRef) {
        stopTimer(); 
        
        const state = gameState[currentTab];
        const q = state.list[state.idx];
        let isCorrect = false;

        if (currentTab === 'fact') {
            const userType = (userIndex === 'fact') ? 'fact' : 'opinion';
            isCorrect = (userType === q.t);
            disableAllButtons();
        } else {
            const correctIdx = (q.c !== undefined) ? q.c : q.correct;
            isCorrect = (userIndex === correctIdx);
            disableAllButtons();
            
            const opts = document.getElementById('opt-btns').children;
            if (isCorrect) {
                btnRef.style.background = '#e8f8f5';
                btnRef.style.borderColor = '#2ecc71';
            } else {
                btnRef.style.background = '#fdedec';
                btnRef.style.borderColor = '#e74c3c';
                if(opts[correctIdx]) {
                    opts[correctIdx].style.background = '#e8f8f5';
                    opts[correctIdx].style.borderColor = '#2ecc71';
                }
            }
        }

        if (isCorrect) {
            globalScore += 1;
            document.getElementById('global-score').innerText = globalScore;
        }

        const fb = document.getElementById('feedback');
        fb.style.display = 'block';
        fb.className = isCorrect ? 'feedback-box correct' : 'feedback-box wrong';
        fb.innerHTML = `<strong>${isCorrect ? 'ğŸ‰ ç­”å¯¹äº†ï¼' : 'ğŸ˜… å“å‘€ï¼Œç­”é”™äº†'}</strong><div class="explain-text">${q.e || q.explain}</div>`;
        
        document.getElementById('next-btn').style.display = 'block';
    }

    function nextQuestion() {
        const state = gameState[currentTab];
        state.idx++;
        
        if (state.idx >= state.list.length) {
            state.finished = true;
            document.querySelector(`.nav-btn[data-tab="${currentTab}"]`).classList.add('finished');
            
            if (gameState.fact.finished && gameState.wolf.finished && gameState.logic.finished) {
                calculateFinalReward();
            } else {
                document.getElementById('game-card').style.display = 'none';
                document.getElementById('done-card').style.display = 'block';
            }
        } else {
            renderQuestion();
        }
    }

    function calculateFinalReward() {
        document.getElementById('game-card').style.display = 'none';
        document.getElementById('done-card').style.display = 'none';
        document.getElementById('coupon-card').style.display = 'block';

        let finalTime = 0;
        let msg = "";
        let showBonus = false;
        const score = globalScore;

        // å¥–åŠ±æœºåˆ¶ (æ€»åˆ†50)
        if (score >= 45) {
            finalTime = 60; 
            msg = "ğŸ† å¤ªæ£’äº†ï¼å‡ ä¹å…¨å¯¹ï¼è¿™æ˜¯ç»™æœ€å¼ºå¤§è„‘çš„æœ€é«˜å¥–åŠ±ï¼š60åˆ†é’Ÿï¼";
            showBonus = true;
        } else if (score >= 38) {
            finalTime = 45;
            msg = "ğŸ˜ éå¸¸ä¼˜ç§€ï¼é”™å¾—å¾ˆå°‘ï¼Œå¥–åŠ± 45 åˆ†é’Ÿï¼";
            showBonus = true;
        } else if (score >= 30) {
            finalTime = 30;
            msg = "ğŸ™‚ è¡¨ç°ä¸é”™ï¼Œå†æ¥å†å‰ï¼å¥–åŠ± 30 åˆ†é’Ÿã€‚";
        } else {
            finalTime = 20;
            msg = "ğŸ˜… çœ‹æ¥è¿˜éœ€è¦å¤šç»ƒä¹ å“¦ï¼Œæš‚æ—¶å…ˆç»™ 20 åˆ†é’Ÿå§ï¼";
        }

        document.getElementById('raw-score').innerText = score;
        document.getElementById('final-minutes').innerText = finalTime;
        document.getElementById('reward-explain').innerText = msg;
        
        if (showBonus) {
            document.getElementById('bonus-msg').style.display = 'inline-block';
        }
    }

    // å¯åŠ¨æ¸¸æˆ
    initGame();

</script>
</body>
</html>
